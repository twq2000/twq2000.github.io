[{"title":"ã€ŒSpringã€ ä½ å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„æ¡†æ¶äº†ï¼Œåº”è¯¥å­¦ä¼šè‡ªå·±æ³¨å†Œç»„ä»¶ï¼","url":"/2022/01/19/%E3%80%8CSpring%E3%80%8D%E4%BD%A0%E5%B7%B2%E7%BB%8F%E6%98%AF%E4%B8%80%E4%B8%AA%E6%88%90%E7%86%9F%E7%9A%84%E6%A1%86%E6%9E%B6%E4%BA%86%EF%BC%8C%E5%BA%94%E8%AF%A5%E5%AD%A6%E4%BC%9A%E8%87%AA%E5%B7%B1%E6%B3%A8%E5%86%8C%E7%BB%84%E4%BB%B6/","content":"åŸæ–‡é“¾æ¥ğŸ”—ï¼šå¾®ä¿¡å…¬ä¼—å· BugNotFoundException\n\n\næœ¬æ–‡å†…å®¹ï¼š\næ ¹æ®å¯¹äº Spring çš„æºç å­¦ä¹ ï¼Œå¯¹å…¶è¿›è¡Œæ”¹é€ ï¼Œå®ç°è‡ªåŠ¨å°†ç»„ä»¶æ³¨å†Œå…¥IOCå®¹å™¨ï¼ˆä¸ç”¨å†ä¸ºæ¯ä¸ªéœ€è¦æ³¨å†Œçš„ç±»æ‰‹å†™ @Component ã€ @Service ç­‰æ³¨è§£ï¼‰ï¼Œåªéœ€è¦å…³å¿ƒä¸šåŠ¡ä»£ç æœ¬èº«å³å¯ã€‚\n\n@Import@Import æ”¯æŒä¸‰ç§ä½¿ç”¨å§¿åŠ¿ï¼š\nå¸¦æœ‰ @Configuration çš„ JavaConfig é…ç½®ç±»è¿™ä¹Ÿæ˜¯å¹³æ—¶ä½¿ç”¨çš„æœ€å¤šçš„æ–¹å¼å°±æ˜¯ç¬¬ä¸€ç§äº†ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªä¸»é…ç½®ç±» SpringConfiguration ï¼Œç°åœ¨è¿˜éœ€è¦å£°æ˜å¹¶æ³¨å†Œä¸€äº›æ•°æ®åº“ç›¸å…³çš„ç»„ä»¶Beanã€‚å½“ç„¶å¯ä»¥ç»§ç»­å†™åœ¨å½“å‰ä¸»é…ç½®ç±»ä¸­ï¼Œä½†æ˜¯ç»„ä»¶ä¸€æ—¦å˜å¾—å¤šèµ·æ¥ï¼Œæ—¥åæŸ¥æ‰¾å°±ç›¸å½“çƒ¦æ¼äº†ã€‚æ›´æ¸…æ™°çš„ä¸€ç§ç¼–å†™æ–¹å¼æ˜¯ï¼šå°†æ•°æ®åº“ç›¸å…³çš„å†…å®¹æ‹†åˆ†å‡ºå»ï¼Œä¾‹å¦‚æ–°å»ºä¸€ä¸ªç±» JdbcConfiguration ï¼Œç„¶åä¸»é…ç½®ç±»ä¸æ•°æ®åº“é…ç½®ç±»ä¹‹é—´å¯ä»¥é€šè¿‡ @Import è¿›è¡Œå¼•å…¥ã€‚\n\n\nå®ç° ImportSelector æ¥å£ï¼Œå¹¶è‡ªå®šä¹‰å…¶ä¸­çš„è§„åˆ™å¯ä»¥é€šè¿‡å®ç° ImportSelector æ¥å£å’Œ ImportBeanDefinitionRegistrar æ¥å£ï¼Œå¹¶åœ¨å…¶ä¸­è‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ³¨å†Œè§„åˆ™ï¼Œå®ç°è‡ªåŠ¨æ‰¹é‡æ³¨å†Œç»„ä»¶ç­‰æ“ä½œã€‚\nè§‚å¯Ÿæ¥å£çš„æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ªåä¸º selectImports çš„æ–¹æ³•éœ€è¦æˆ‘ä»¬å»å®ç°ã€‚\n\n\n\nå®ç°ç±»ä»£ç /** * è‡ªå®šä¹‰ ImportSelector * å®ç°åŠŸèƒ½ï¼šå°†ç»„ä»¶æ‰¹é‡æ³¨å†Œå…¥IOCå®¹å™¨ */public class CustomImportSelector implements ImportSelector &#123;    private static final String BASE_PACKAGES = &quot;basePackages&quot;;  /** AspectJè¡¨è¾¾å¼ */  private final String expression;  /** ç”¨æˆ·æŒ‡å®šçš„æ‰«æåŒ… */  private final String customPackage;  /**   * é»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°   * ç”¨äºè¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶åˆå§‹åŒ–èµ‹å€¼å…¨å±€å˜é‡   */  public CustomImportSelector() &#123;    try &#123;      Properties properties = PropertiesLoaderUtils.loadAllProperties(&quot;customImport.properties&quot;);      expression = properties.getProperty(&quot;custom.importSelector.expression&quot;);      customPackage = properties.getProperty(&quot;custom.importSelector.package&quot;);    &#125; catch (IOException e) &#123;      throw new RuntimeException(&quot;è¯»å–é…ç½®æ–‡ä»¶å¤±è´¥&quot;);    &#125;  &#125;  /**   * å°†é…ç½®ç±»ä¸­çš„è¿‡æ»¤è§„åˆ™è®¾ç½®ä¸ºFilterType=ASPECTJï¼Œå¹¶é‡å†™è¯¥æ–¹æ³•   * å®ç°åŠŸèƒ½ï¼šå°†ç±»æ‰¹é‡æ³¨å†Œå…¥IOCå®¹å™¨   * @param importingClassMetadata   * @return   */  @Override  public String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;    // å­˜å‚¨æ‰«æåŒ…çš„é›†åˆ    List&lt;String&gt; basePackages = null;    if (importingClassMetadata.hasAnnotation(ComponentScan.class.getName())) &#123;      // å¦‚æœå½“å‰ç±»å­˜åœ¨@ComponentScanæ³¨è§£ï¼Œåˆ™å–å‡ºå®ƒçš„basePackageså±æ€§å€¼ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºæ‰«æåŒ…      Map&lt;String, Object&gt; attributes = importingClassMetadata.getAnnotationAttributes(ComponentScan.class.getName());      if (attributes.containsKey(BASE_PACKAGES)) &#123;        // å¦‚æœå­˜åœ¨ basePackages å±æ€§ï¼Œåˆ™å–å‡ºå…¶å±æ€§å€¼        basePackages = new ArrayList&lt;&gt;();        Collections.addAll(basePackages, (String[]) attributes.get(BASE_PACKAGES));      &#125;    &#125;    if (basePackages == null || basePackages.isEmpty()) &#123;      // å¦‚æœæœªæŒ‡å®š@ComponentScanæ³¨è§£ï¼Œæˆ–æŒ‡å®šäº†@ComponentScanä½†æ˜¯æœªæŒ‡å®šbasePackagesï¼Œé‚£ä¹ˆéƒ½éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®æ‰«æåŒ…      String basePackage;      try &#123;        // è·å–å½“å‰ç±»æ‰€åœ¨çš„åŒ…åï¼Œä»¥æ­¤ä½œä¸ºæ‰«æåŒ…        basePackage = Class.forName(importingClassMetadata.getClassName()).getPackage().getName();      &#125; catch (ClassNotFoundException e) &#123;        throw new RuntimeException(&quot;è·å–å½“å‰ç±»åŒ…åå¤±è´¥&quot;);      &#125;      // å°†åŒ…ååŠ å…¥é›†åˆä¸­      if (basePackages == null) &#123;        basePackages = new ArrayList&lt;&gt;();      &#125;      basePackages.add(basePackage);    &#125;    // è‡³æ­¤ï¼ŒbasePackagesé›†åˆä¸­å¿…ä¸ä¸ºç©ºï¼Œä¸”å¿…å®šå­˜åœ¨å…ƒç´     if (!StringUtils.isEmpty(customPackage)) &#123;      // å¦‚æœç”¨æˆ·é…ç½®äº†è‡ªå®šä¹‰çš„æ‰«æåŒ…ï¼Œä¹Ÿéœ€è¦åŠ å…¥é›†åˆä¸­      basePackages.add(customPackage);    &#125;    // åˆ›å»ºä¸€ä¸ªç±»è·¯å¾„æ‰«æå™¨ä¸AspectJè¡¨è¾¾å¼è¿‡æ»¤å™¨ï¼Œå¹¶å°†å®ƒä»¬æ•´åˆèµ·æ¥    ClassPathScanningCandidateComponentProvider scanner = new ClassPathScanningCandidateComponentProvider(false);    TypeFilter typeFilter = new AspectJTypeFilter(expression, CustomImportSelector.class.getClassLoader());    scanner.addIncludeFilter(typeFilter);    Set&lt;String&gt; classPaths = new HashSet&lt;&gt;();    for (String basePackage : basePackages) &#123;      scanner.findCandidateComponents(basePackage).forEach(beanDefinition -&gt; classPaths.add(beanDefinition.getBeanClassName()));    &#125;    return classPaths.toArray(new String[0]);  &#125;&#125;\n\n\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨æ— å‚æ„é€ å‡½æ•°ä¸­ï¼Œæ˜¯é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶æ¥è·å–ç”¨æˆ·æŒ‡å®šçš„æ‰«æåŒ…çš„ã€‚\né…ç½®æ–‡ä»¶# ImportSelector ç›¸å…³# AspectJè¡¨è¾¾å¼ï¼štwqåŒ…ä¸‹çš„ ä»»æ„å­åŒ…çš„ ä»»æ„ç±»custom.importSelector.expression=twq..*# åœ¨ä¸Šè¿°è§„åˆ™æˆç«‹çš„å‰æä¸‹ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šå…·ä½“çš„æ‰«æåŒ…custom.importSelector.package=twq# ImportBeanDefinitionRegistrar ç›¸å…³custom.importBeanDefinitionRegistrar.expression=twq..*custom.importBeanDefinitionRegistrar.package=twq\n\nå¯¹åº”åˆ°æˆ‘çš„é¡¹ç›®çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæ˜¯è¿™æ ·çš„ï¼š\n\n    \n    \n    çº¢æ¡†éƒ¨åˆ†ï¼Œå°±æ˜¯æˆ‘é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ‰«æåŒ…èŒƒå›´ï¼štwqåŒ…ï¼ˆåŒ…æ‹¬å­åŒ…ï¼‰ä¸‹çš„æ‰€æœ‰ç±»\n\n\n\n\næœ€åï¼Œåœ¨ä¸»é…ç½®ç±»ä¸Šå¼•å…¥ @Import(CustomImportBeanDefinitionRegistrar.class) å³å¯ã€‚\n@Configuration@Import(CustomImportSelector.class)public class SpringConfiguration &#123;&#125;\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æ—¢æ²¡æœ‰åœ¨é…ç½®ç±»ä¸Šå†™ @ComponentScan ï¼Œä¹Ÿæ²¡æœ‰åœ¨ä»»ä½•ä¸šåŠ¡ç±»ä¸Šå†™ä¾‹å¦‚ @Component ã€ @Service ç­‰æ³¨è§£ã€‚\n\n\næµ‹è¯•ç»“æœç°åœ¨è®©æˆ‘ä»¬å»æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥åŒæ ·è¾¾åˆ°ç»„ä»¶æ³¨å†Œçš„æ•ˆæœã€‚\n\n    \n    \n    å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›ç»„ä»¶éƒ½è¢«æˆåŠŸæ³¨å†Œï¼Œè°ƒç”¨æ–¹æ³•ä¹Ÿæ­£å¸¸æ‰§è¡Œ\n\n\n\n    \n    \n    å¦å¤–ï¼Œé€šè¿‡è¾“å‡ºå½“å‰IOCå®¹å™¨ç»„ä»¶åå¯çŸ¥ï¼šè‡ªåŠ¨ä¸ºå®ƒä»¬åˆ†é…çš„idæ˜¯å„è‡ªçš„å…¨é™å®šåã€‚\n\n\n\n\nå®ç° ImportBeanDefinitionRegistrar æ¥å£ï¼Œå¹¶è‡ªå®šä¹‰å…¶ä¸­çš„è§„åˆ™æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ ImportBeanDefinitionRegistrar æ¥å£çš„å®ç°å§¿åŠ¿ã€‚å…¶å®å®ƒä¸ ImportSelector çš„å®ç°æ€è·¯åŸºæœ¬ä¸€è‡´ã€‚\nå®ç°ç±»ä»£ç /** * è‡ªå®šä¹‰ ImportBeanDefinitionRegistrar * å®ç°åŠŸèƒ½ï¼šå°†ç»„ä»¶æ‰¹é‡æ³¨å†Œå…¥IOCå®¹å™¨ */public class CustomImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar &#123;    private static final String BASE_PACKAGES = &quot;basePackages&quot;;  /** AspectJè¡¨è¾¾å¼ */  private final String expression;  /** ç”¨æˆ·æŒ‡å®šçš„æ‰«æåŒ… */  private final String customPackage;  /**   * é»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°   * ç”¨äºè¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶ç»™ä¸€äº›å…¨å±€å˜é‡èµ‹å€¼   */  public CustomImportBeanDefinitionRegistrar() &#123;    try &#123;      Properties properties = PropertiesLoaderUtils.loadAllProperties(&quot;customImport.properties&quot;);      expression = properties.getProperty(&quot;custom.importBeanDefinitionRegistrar.expression&quot;);      customPackage = properties.getProperty(&quot;custom.importBeanDefinitionRegistrar.package&quot;);    &#125; catch (IOException e) &#123;      throw new RuntimeException(&quot;è¯»å–é…ç½®æ–‡ä»¶å¤±è´¥&quot;);    &#125;  &#125;  /**   * å°†é…ç½®ç±»ä¸­çš„è¿‡æ»¤è§„åˆ™è®¾ç½®ä¸ºFilterType=ASPECTJï¼Œå¹¶é‡å†™è¯¥æ–¹æ³•   * å®ç°åŠŸèƒ½ï¼šé€šè¿‡æŒ‡å®šæ‰«æåŒ…ï¼Œè‡ªåŠ¨å°†ç»„ä»¶æ³¨å†Œå…¥IOCå®¹å™¨   * @param importingClassMetadata   * @param registry   */  @Override  public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123;    List&lt;String&gt; basePackages = null;    if (importingClassMetadata.hasAnnotation(ComponentScan.class.getName())) &#123;      // å¦‚æœå½“å‰ç±»å­˜åœ¨@ComponentScanæ³¨è§£ï¼Œåˆ™å–å‡ºå®ƒçš„basePackageså±æ€§å€¼ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºæ‰«æåŒ…      Map&lt;String, Object&gt; attributes = importingClassMetadata.getAnnotationAttributes(ComponentScan.class.getName());      if (attributes.containsKey(BASE_PACKAGES)) &#123;        // å¦‚æœå­˜åœ¨ basePackages å±æ€§ï¼Œåˆ™å–å‡ºå…¶å±æ€§å€¼        basePackages = new ArrayList&lt;&gt;();        Collections.addAll(basePackages, (String[]) attributes.get(BASE_PACKAGES));      &#125;    &#125;    if (basePackages == null || basePackages.isEmpty()) &#123;      // å¦‚æœæœªæŒ‡å®š@ComponentScanæ³¨è§£ï¼Œæˆ–æŒ‡å®šäº†@ComponentScanä½†æ˜¯æœªæŒ‡å®šbasePackagesï¼Œé‚£ä¹ˆéƒ½éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®æ‰«æåŒ…      String basePackage;      try &#123;        // è·å–å½“å‰ç±»æ‰€åœ¨çš„åŒ…åï¼Œä»¥æ­¤ä½œä¸ºæ‰«æåŒ…        basePackage = Class.forName(importingClassMetadata.getClassName()).getPackageName();      &#125; catch (ClassNotFoundException e) &#123;        throw new RuntimeException(&quot;è·å–å½“å‰ç±»åŒ…åå¤±è´¥&quot;);      &#125;      // å°†åŒ…ååŠ å…¥é›†åˆä¸­      if (basePackages == null) &#123;        basePackages = new ArrayList&lt;&gt;();      &#125;      basePackages.add(basePackage);    &#125;    // è‡³æ­¤ï¼ŒbasePackagesé›†åˆä¸­å¿…ä¸ä¸ºç©ºï¼Œä¸”å¿…å®šå­˜åœ¨å…ƒç´     if (!StringUtils.isEmpty(customPackage)) &#123;      // å¦‚æœç”¨æˆ·é…ç½®äº†è‡ªå®šä¹‰çš„æ‰«æåŒ…ï¼Œä¹Ÿéœ€è¦åŠ å…¥é›†åˆä¸­      basePackages.add(customPackage);    &#125;    // åˆ›å»ºä¸€ä¸ªç±»è·¯å¾„æ‰«æå™¨ä¸AspectJè¡¨è¾¾å¼è¿‡æ»¤å™¨ï¼Œå¹¶å°†å®ƒä»¬æ•´åˆèµ·æ¥    ClassPathBeanDefinitionScanner scanner = new ClassPathBeanDefinitionScanner(registry, false);    TypeFilter typeFilter = new AspectJTypeFilter(expression, CustomImportBeanDefinitionRegistrar.class.getClassLoader());    scanner.addIncludeFilter(typeFilter);    // æ‰«æé›†åˆä¸­çš„è¿™äº›åŒ…    scanner.scan(basePackages.toArray(new String[0]));  &#125;&#125;\n\n\né…ç½®ç±»ä»£ç @Configuration@Import(CustomImportBeanDefinitionRegistrar.class)public class SpringConfiguration &#123;&#125;\n\n\næµ‹è¯•ç»“æœ\n\nè¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼šè™½ç„¶åœ¨ä¸Šé¢çš„å›¾ç‰‡ä¸­ï¼Œçœ‹åˆ°ç›¸å…³æ³¨è§£çš„å±æ€§çˆ†çº¢äº†ï¼šideaè¡¨ç¤ºæ— æ³•è§£æè¿™ä¸ªbean nameã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å†™ä»»ä½• @Component ï¼Œidea è¿˜ä»¥ä¸ºä¸å­˜åœ¨è¿™äº›ç»„ä»¶ã€‚ä½†å…¶å®æˆ‘ä»¬å·²ç»é€šè¿‡ ImportBeanDefinitionRegistrar æ¥å£å¸®æˆ‘ä»¬è¿›è¡Œç»„ä»¶æ³¨å†Œäº†ï¼Œæ‰€ä»¥æµ‹è¯•ç»“æœæ˜¯æ²¡é—®é¢˜çš„~~ :laughing:\n\n\næ€»ç»“ï¼š\nImportSelector è‡ªåŠ¨æ³¨å†Œæ—¶ï¼Œåˆ†é…çš„ç»„ä»¶åè§„åˆ™æ˜¯ï¼šå„è‡ªç±»çš„å…¨é™å®šå ã€‚\n\nImportBeanDefinitionRegistrar è‡ªåŠ¨æ³¨å†Œæ—¶ï¼Œåˆ†é…çš„ç»„ä»¶åè§„åˆ™æ˜¯ï¼šå„è‡ªç±»çš„ç±»çŸ­å+é¦–å­—æ¯å°å†™çš„æ³¨å…¥æ–¹å¼ ã€‚\n\n\n","tags":["Java","Spring"]},{"title":"ã€ŒäºŒåˆ†æœ€å€¼ã€ äºŒåˆ†æ³•è¿˜èƒ½è¿™ä¹ˆç”¨ï¼Ÿï¼","url":"/2022/05/14/%E3%80%8C%E4%BA%8C%E5%88%86%E6%9C%80%E5%80%BC%E3%80%8D%E4%BA%8C%E5%88%86%E6%B3%95%E8%BF%98%E8%83%BD%E8%BF%99%E4%B9%88%E7%94%A8%EF%BC%9F%EF%BC%81/","content":"å‰è¨€æœ¬æ–‡çš„çŸ¥è¯†æ˜¯å»ºç«‹äºç†Ÿæ‚‰æŒæ¡äºŒåˆ†æ³•çš„æ€æƒ³ä¸æ¨¡æ¿ä»£ç ä¹‹ä¸Šçš„ã€‚\nå› æ­¤ï¼Œå¦‚æœå­˜åœ¨ä»»ä½•ä¸ç¡®å®š&#x2F;ç–‘é—®ï¼Œå¯ä»¥å…ˆç§»æ­¥è‡³æ­¤ ğŸ‘‰ ã€ŒäºŒåˆ†æ³•ã€äºŒåˆ†æœ€ç¡¬å¹²è´§ï¼Œå°±åœ¨è¿™äº†ï¼ ï¼Œå…¶ä¸­ç»™å‡ºäº†å®ç”¨çš„äºŒåˆ†æŸ¥æ‰¾æ¨¡æ¿ä»£ç ã€‚\nå¦‚æœå·²ç»æ¸©ä¹ å®Œæ¯•&#x2F;è¶³å¤Ÿç†Ÿæ‚‰ï¼Œé‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹äº†~\n\n\né¢˜å•æ±‡æ€» ğŸ·ï¸æ˜¾å¼æœ€å€¼é—®é¢˜ç®€å•è®¡ç®—\nLeetCode.1283 â€“ ä½¿ç»“æœä¸è¶…è¿‡é˜ˆå€¼çš„æœ€å°é™¤æ•°\nLeetCode.1300 â€“ è½¬å˜æ•°ç»„åæœ€æ¥è¿‘ç›®æ ‡å€¼çš„æ•°ç»„å’Œ\nLeetCode.875 â€“ çˆ±åƒé¦™è•‰çš„ç‚ç‚\nLeetCode.2064 â€“ åˆ†é…ç»™å•†åº—çš„æœ€å¤šå•†å“çš„æœ€å°å€¼\nLeetCode.1870 â€“ å‡†æ—¶åˆ°è¾¾çš„åˆ—è½¦æœ€å°æ—¶é€Ÿ\nLeetCode.1760 â€“ è¢‹å­é‡Œæœ€å°‘æ•°ç›®çš„çƒ\n\nå†å²æ ‡è®°\nLeetCode.1552 â€“ ä¸¤çƒä¹‹é—´çš„ç£åŠ›\nLeetCode.1482 â€“ åˆ¶ä½œ m æŸèŠ±æ‰€éœ€çš„æœ€å°‘å¤©æ•°\nLeetCode.1011 â€“ åœ¨ D å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›\n\næ»‘åŠ¨çª—å£\nLCP.12 â€“ å°å¼ åˆ·é¢˜è®¡åˆ’\n\nè§„å¾‹è®¡ç®—\nLeetCode.1954 â€“ æ”¶é›†è¶³å¤Ÿè‹¹æœçš„æœ€å°èŠ±å›­å‘¨é•¿\nLeetCode.1802 â€“ æœ‰ç•Œæ•°ç»„ä¸­æŒ‡å®šä¸‹æ ‡å¤„çš„æœ€å¤§å€¼\n\nçº¿æ€§åŒ¹é…\nLeetCode.1898 â€“ å¯ç§»é™¤å­—ç¬¦çš„æœ€å¤§æ•°ç›®\n\n\n\néšå¼æœ€å€¼é—®é¢˜\nLeetCode.287 â€“ å¯»æ‰¾é‡å¤æ•°\nLeetCode.1648 â€“ é”€å”®ä»·å€¼å‡å°‘çš„é¢œè‰²çƒ\nLeetCode.274 â€“ H æŒ‡æ•°\nLeetCode.400 â€“ ç¬¬ N ä½æ•°å­—\n\n\n\nç‰¹æ®ŠäºŒåˆ†\nLeetCode.2187 â€“ å®Œæˆæ—…é€”çš„æœ€å°‘æ—¶é—´\n\n","tags":["ç®—æ³•","äºŒåˆ†æŸ¥æ‰¾"]},{"title":"ã€ŒSpringã€ ä½ å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„æ¡†æ¶äº†ï¼Œåº”è¯¥å­¦ä¼šè‡ªå·±è¯»å–yamlæ–‡ä»¶ï¼","url":"/2022/01/30/%E3%80%8CSpring%E3%80%8D%E4%BD%A0%E5%B7%B2%E7%BB%8F%E6%98%AF%E4%B8%80%E4%B8%AA%E6%88%90%E7%86%9F%E7%9A%84%E6%A1%86%E6%9E%B6%E4%BA%86%EF%BC%8C%E5%BA%94%E8%AF%A5%E5%AD%A6%E4%BC%9A%E8%87%AA%E5%B7%B1%E8%AF%BB%E5%8F%96yaml%E6%96%87%E4%BB%B6/","content":"åŸæ–‡é“¾æ¥ğŸ”—ï¼šå¾®ä¿¡å…¬ä¼—å· BugNotFoundException\n\n\næœ¬æ–‡å†…å®¹ï¼š\næ ¹æ®å¯¹äº Spring çš„æºç å­¦ä¹ ï¼Œå¯¹å…¶è¿›è¡Œæ”¹é€ ï¼Œé€šè¿‡å®ç° PropertySourceFactory æ¥å£ï¼Œä½¿Springå¯ä»¥è¯»å– yaml æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚\n\n@PropertySourceæˆ‘ä»¬çŸ¥é“ï¼Œ@PropertySourceé»˜è®¤æ”¯æŒè¯»å–çš„æ˜¯ .properties å’Œ .xml æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚\nä¸è¿‡å°±ç›®å‰è€Œè¨€ï¼Œæ›´å—æ¬¢è¿ä¸”ä¸»æµçš„é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯ .yml ã€‚ä½†å¾ˆé—æ†¾çš„æ˜¯ï¼ŒSpringåŸç”Ÿå¹¶ä¸æ”¯æŒã€‚\né‚£ä¹ˆï¼Œåªå¥½è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿå§~ :thinking:\næ‰€ä»¥æ¥ä¸‹æ¥å°±è‡ªå·±å®ç°ä¸€ä¸ªå¯æ”¯æŒ .yml æ ¼å¼çš„ @PropertySource ~\n\n\næºç åˆ†æé¦–å…ˆç‚¹è¿›æ¥è¿™ä¸ª @PropertySource åˆ†æä¸€ç•ªã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œéœ€è¦çš„æ˜¯ä¸€ä¸ªè§£æå™¨å·¥å‚ç±»ï¼Œæ¥å£ä¸º PropertySourceFactory ï¼Œè€Œæ¡†æ¶æä¾›çš„é»˜è®¤å®ç°ç±»æ˜¯ DefaultPropertySourceFactory ã€‚\n\n\n\né‚£ä¹ˆæˆ‘ä»¬å°±ç…§çŒ«ç”»è™ï¼Œå®ç°ä¸€ä¸ªè‡ªå·±çš„ `CustomPropertySourceFactory` ã€‚\n\n\n\nå®ç°å®ç°æ€è·¯å°±æ˜¯ï¼šå°† yaml æ–‡ä»¶è§£æå¹¶è½¬ä¸º properties æ–‡ä»¶ï¼Œç„¶åå†äº¤ç”±Springå»è¯»å–ã€‚\nè¿™é‡Œæˆ‘é€‰æ‹©å¯¼å…¥ç¬¬ä¸‰æ–¹ä¾èµ– snakeyaml ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬è§£æ yaml æ–‡ä»¶å¹¶è½¬ä¸º properties æ–‡ä»¶ã€‚\nå®ç°ç±»ä»£ç /** * è‡ªå®šä¹‰ PropertySourceFactory * å®ç°åŠŸèƒ½ï¼šå…è®¸è¯»å–ymlæ ¼å¼çš„é…ç½®æ–‡ä»¶ */public class CustomPropertySourceFactory implements PropertySourceFactory &#123;  @Override  public PropertySource&lt;?&gt; createPropertySource(String name, EncodedResource resource) throws IOException &#123;    // åˆ›å»ºä¸€ä¸ªyamlæ–‡ä»¶è§£æå·¥å‚    YamlPropertiesFactoryBean factoryBean = new YamlPropertiesFactoryBean();    factoryBean.setResources(resource.getResource());    // å°†ä¼ å…¥çš„èµ„æºè§£æä¸º properties æ–‡ä»¶ã€‚è¿™æ ·ï¼Œspringå°±æ”¯æŒè¯»å–äº†    Properties properties = factoryBean.getObject();    return name == null ? new PropertiesPropertySource(resource.getResource().getFilename(), properties)        : new PropertiesPropertySource(name, properties);  &#125;&#125;\n\nè‡³æ­¤ï¼Œå°±å¯ä»¥æ„‰å¿«åœ°å°†é…ç½®æ–‡ä»¶æ”¹ä¸º .yml æ ¼å¼çš„å•¦ã€‚ä½†æ˜¯åˆ«å¿˜äº†å°† @PropertySource çš„ factory å±æ€§æŒ‡å‘è‡ªå·±è‡ªå®šä¹‰çš„å·¥å‚è§£æç±»å“¦~\n\n\né…ç½®ç±»ä»£ç @Configuration@PropertySource(value = &quot;classpath:jdbc.yml&quot;, factory = CustomPropertySourceFactory.class)public class JdbcConfiguration &#123;  @Value(&quot;$&#123;jdbc.windows.driverClassName&#125;&quot;) private String driver;  @Value(&quot;$&#123;jdbc.windows.url&#125;&quot;) private String url;  @Value(&quot;$&#123;jdbc.windows.username&#125;&quot;) private String username;  @Value(&quot;$&#123;jdbc.windows.password&#125;&quot;) private String password;  @Bean(name = &quot;dataSource&quot;)  public DataSource dataSource() &#123;    DriverManagerDataSource dataSource = new DriverManagerDataSource();    dataSource.setDriverClassName(driver);    dataSource.setUrl(url);    dataSource.setUsername(username);    dataSource.setPassword(password);    return dataSource;  &#125;&#125;","tags":["Java","Spring"]},{"title":"ã€ŒäºŒåˆ†æ³•ã€æœ€ç¡¬å¹²è´§ï¼Œé€Ÿè¿›ï¼","url":"/2022/04/02/%E3%80%8C%E4%BA%8C%E5%88%86%E6%B3%95%E3%80%8D%E4%BA%8C%E5%88%86%E6%9C%80%E7%A1%AC%E5%B9%B2%E8%B4%A7%EF%BC%8C%E5%B0%B1%E5%9C%A8%E8%BF%99%E4%BA%86%EF%BC%81/","content":"å‰è¨€äºŒåˆ†æ³•æ˜¯ä¸€ä¸ªå¹¿æ³›åº”ç”¨äºè®¡ç®—æœºä¸–ç•Œçš„ç»å…¸ç®—æ³•ï¼Œç›¸ä¿¡æ²¡æœ‰å“ªä¸ªç¨‹åºå‘˜ä¼šä¸çŸ¥é“å®ƒã€‚\näºŒåˆ†æŸ¥æ‰¾çš„æœ¬è´¨æ˜¯é€šè¿‡ä¸æ–­çš„åˆ¤æ–­ï¼Œå†³å®šåŒºé—´çš„å–èˆï¼Œæœ€ç»ˆå¤¹å‡ºæ‰€éœ€ç­”æ¡ˆã€‚ä½¿ç”¨äºŒåˆ†æ³•ï¼Œå¯ä»¥è®©ä½ åœ¨æœ‰åºæ•°ç»„ä¸­ï¼Œä»¥ O(logn) çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ‰¾åˆ°æƒ³è¦çš„ç­”æ¡ˆã€‚\nä½†æ˜¯ï¼Œç½‘ä¸Šå…³äºäºŒåˆ†çš„æ•™å­¦æ»¡å¤©é£ï¼Œå¤§è‡´åˆ†ä¸º while (left &lt;= right) å’Œ while (left &lt; right) ï¼Œç„¶åæ›´æ–°å¼åˆæ˜¯äº”èŠ±å…«é—¨ï¼šæœ‰çš„æ˜¯ left = middle + 1 å’Œ right = middle - 1 ï¼Œæœ‰çš„æ˜¯ left = middle + 1 å’Œ right = middle â€¦â€¦\nç¨æœ‰ä¸æ…å†™é”™äº†ï¼ŒäºŒåˆ†å°±è¿›å…¥äº†æ­»å¾ªç¯ ğŸ˜­ æœ¬æ¥æ˜¯ä¸ºäº†åŠ é€ŸæŸ¥æ‰¾ï¼Œè¿™ä¸‹å¥½äº†ï¼Œåå‘åŠ é€Ÿäº†å±äºæ˜¯ã€‚\n\n\næ‰€ä»¥ï¼Œä¸å¤šé€¼é€¼ï¼Œç›´æ¥ä¸Šå¹²è´§ï¼\næ¨¡æ¿ä»£ç ç»Ÿä¸€ä½¿ç”¨ while (left &lt; right) ï¼Œå¹¶ä¸”ï¼š\n\nå¯»æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³XXXçš„ä½ç½®ï¼šint left = 0, right = nums.length - 1;while (left &lt; right) &#123;  int middle = left + (right - left) / 2;  if (æ»¡è¶³XXX) &#123;    right = middle;  &#125; else &#123;    left = middle + 1;  &#125;&#125;\nå¯»æ‰¾æœ€åä¸€ä¸ªæ»¡è¶³XXXçš„ä½ç½®ï¼šint left = 0, right = nums.length - 1;while (left &lt; right) &#123;  // +1æ˜¯ä¸ºäº†è®©ç›¸é™¤ç»“æœå‘ä¸Šå–æ•´ï¼Œè¿™ä¸ªåœ°æ–¹å°±æ˜¯ä¸¤å¥—æ¨¡æ¿çš„åŒºåˆ«ä¹‹ä¸€  int middle = left + (right - left + 1) / 2;  if (æ»¡è¶³XXX) &#123;    left = middle;  &#125; else &#123;    right = middle - 1;  &#125;&#125;\n\n\n\næœ€ç»ˆçš„äºŒåˆ†ç»“æœï¼Œè¿”å› left æˆ– right éƒ½å¯ï¼Œå› ä¸ºé€€å‡ºå¾ªç¯æ—¶ä¸€å®šæœ‰ left==right ã€‚\n\nä½ å¯ä»¥æŠŠè¿™ä¸¤ç§æ¨¡æ¿éƒ½è®°ä½ï¼Œä¹Ÿå¯ä»¥åªé€‰æ‹©å…¶ä¸­ä¸€å¥—çœ‹ç€æ›´é¡ºçœ¼çš„ã€‚å› ä¸ºè¿™ä¸¤ç§æ¨¡æ¿ä¹‹é—´çš„ç»“æœæ˜¯å¯ä»¥äº’ç›¸è½¬åŒ–çš„ã€‚\nå‡è®¾ä½ åªä¼šç”¨ å¯»æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³XXX è¿™ä¸ªæ¨¡æ¿ï¼Œä½†æ˜¯é‡åˆ°çš„å®é™…éœ€æ±‚æ˜¯ å¯»æ‰¾æœ€åä¸€ä¸ªæ»¡è¶³XXX ï¼Œé‚£ä½ ä¹Ÿå®Œå…¨å¯ä»¥å°†äºŒåˆ†ç›®æ ‡åŠ¨æ€åœ°ä¿®æ”¹ä¸ºï¼š å¯»æ‰¾ç¬¬ä¸€ä¸ªä¸æ»¡è¶³XXX çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯æŠŠ if æ¡ä»¶ æ”¹æˆå¯¹åº”ç›¸åçš„ï¼Œå…¶ä½™éƒ½ä¸ç”¨åŠ¨ï¼‰ã€‚å¯çŸ¥å®ƒçš„ä¸Šä¸€ä¸ªä½ç½®å°±æ˜¯ æœ€åä¸€ä¸ªæ»¡è¶³XXX çš„ï¼Œå³ï¼šæŠŠå¾—åˆ°çš„äºŒåˆ†ç»“æœå‡å»1ï¼Œå°±æ˜¯ç­”æ¡ˆäº†ã€‚åä¹‹åŒç†ï¼Œç”± æœ€åä¸€ä¸ª -&gt; ç¬¬ä¸€ä¸ª æ˜¯ åŠ 1æ“ä½œã€‚\n\n\nä¸è¿‡ï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœï¼Œå¾ˆå¤šæ—¶å€™éƒ½éœ€è¦è¿›è¡Œ åå¤„ç†åˆ¤æ–­ ï¼Œå¦åˆ™ä¼šå¸¦æ¥é—®é¢˜ã€‚\n\nå¦‚æœä½ æ˜¯ç”± ä¸€ç§æƒ…å†µ è½¬åŒ–åˆ° å¦ä¸€ç§æƒ…å†µ çš„è¯ï¼Œå¯èƒ½ä¼šå¸¦æ¥ ç´¢å¼•è¶Šç•Œ çš„é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºï¼šåœ¨ç»“æœè½¬åŒ–æ—¶ä¸€å®šä¼šè¿›è¡Œ -1 (æˆ–è€… +1) çš„æ“ä½œã€‚é‚£ä¹ˆå‡è®¾æœ¬èº«çš„äºŒåˆ†ç»“æœæ˜¯0ï¼Œç„¶åå†å‡1ï¼Œå˜æˆ-1äº†ã€‚\næ‰€ä»¥åœ¨æœ€åè¿”å›å‰ï¼Œå¿…é¡»åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªä¸‹æ ‡ç©¶ç«Ÿæ˜¯å¦åˆæ³•ï¼ˆå¦‚æœé¢˜ç›®ä¿è¯ä¸€å®šå­˜åœ¨ç­”æ¡ˆï¼Œé‚£ä¹ˆå¤§å¯æ”¾å¿ƒä¸å¿…è¿›è¡Œè¿™äº›åˆ¤æ–­ï¼‰ï¼š\n\n\n// è¿™é‡Œç”¨ -1 è¡¨ç¤ºä¸‹æ ‡éæ³•æ—¶çš„è¿”å›ç»“æœreturn left &gt;= 0 &amp;&amp; left &lt; nums.length ? left : -1;\n\n\nå¦å¤–ï¼Œå¦‚æœé¢˜ç›®ä¸ä¿è¯ä¸€å®šå­˜åœ¨ç­”æ¡ˆï¼Œé‚£ä¹ˆå³ä½¿æ²¡æœ‰äº§ç”Ÿ ç´¢å¼•è¶Šç•Œ ï¼Œä¹Ÿå¯èƒ½å¾—åˆ° é”™è¯¯ç­”æ¡ˆ ã€‚\nä¾‹å¦‚ å¯»æ‰¾æœ‰åºæ•°ç»„ä¸­å…ƒç´ å€¼ä¸º target çš„å…ƒç´ æ‰€åœ¨ä½ç½®ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯å®ƒä¸€å®šå­˜åœ¨ ã€‚æ‹¿åˆ°è¿™é¢˜ï¼Œæˆ‘ä¾¿è®¾å®šäºŒåˆ†ç›®æ ‡æ˜¯ï¼š å¯»æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³ nums[i] &gt;= target çš„ä½ç½® i ï¼Œæœ€ç»ˆæˆ‘å¾—åˆ°çš„äºŒåˆ†ç»“æœæ˜¯ left (åŒæ ·ä¹Ÿå¯ä»¥æ˜¯ right ) ã€‚å¯æ˜¯æˆ‘åªçŸ¥é“ nums[left] &gt;= target æ˜¯æ²¡é”™çš„ï¼Œä½†ä¸ä»£è¡¨ nums[left] == target ä¹Ÿä¸€å®šæ²¡é”™ï¼Œå› ä¸ºå¯èƒ½ target å‹æ ¹å°±ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼ï¼\næ‰€ä»¥å°±å¿…é¡»è¦åå¤„ç†åˆ¤æ–­ï¼š\n\n\n// è¿™é‡Œç”¨ -1 è¡¨ç¤ºæ•°ç»„ä¸­ä¸å­˜åœ¨ target çš„è¿”å›ç»“æœreturn nums[left] == target ? left : -1;\n\n\n\næœ€åï¼Œè¿˜æ˜¯è¦å•°å—¦ä¸€ä¸‹ï¼šå¦‚æœé¢˜ç›®ä¿è¯ç­”æ¡ˆæ˜¯å­˜åœ¨çš„ï¼Œé‚£ä¹ˆä»¥ä¸Šè¿™äº›åå¤„ç†çš„åˆ¤æ–­éƒ½æ˜¯ä¸å¿…çš„ï¼Œä½ å¾—åˆ°çš„ç»“æœä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚å½“ç„¶ï¼Œä½ æ€»æ˜¯è¿›è¡Œååˆ¤æ–­å¤„ç†ï¼Œé‚£ä¹Ÿæ˜¯å¾ˆä¸¥è°¨çš„~\n","tags":["ç®—æ³•","äºŒåˆ†æŸ¥æ‰¾"]},{"title":"ã€ŒåŠ¨æ€è§„åˆ’ã€è‚¡ç¥å…»æˆè®°","url":"/2022/02/27/%E3%80%8C%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E2%80%94%E2%80%94%E8%82%A1%E7%A5%A8%E7%B3%BB%E5%88%97%E3%80%8D%E8%82%A1%E7%A5%9E%E5%85%BB%E6%88%90%E8%AE%B0/","content":"åŸæ–‡é“¾æ¥ğŸ”—ï¼šå¾®ä¿¡å…¬ä¼—å· BugNotFoundException\n\n\nè‚¡ç¥¨é—®é¢˜ç³»åˆ— æ˜¯åŠ¨æ€è§„åˆ’å…¥é—¨çš„ç»å…¸ç³»åˆ—äº†ã€‚\næœ¬æ–‡å°†æ”¶å½• LeetCode ä¸Šçš„æ‰€æœ‰ç›¸å…³é—®é¢˜ï¼Œä»¥æ­¤æ€»ç»“è‚¡ç¥¨å¸‚åœºçš„æ“ä½œç»éªŒã€‚\n\né¢˜ç›®1 â€“ LeetCode.121é¢˜é¢\nç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ä½ åªèƒ½é€‰æ‹© æŸä¸€å¤© ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­ å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› 0 ã€‚\n\nç¤ºä¾‹1ï¼š\n\nè¾“å…¥ï¼š[7,1,5,3,6,4]è¾“å‡ºï¼š5è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 6ï¼‰çš„æ—¶å€™å–å‡ºã€‚\n\nç¤ºä¾‹2ï¼š\n\nè¾“å…¥ï¼šprices &#x3D; [7,6,4,3,1]è¾“å‡ºï¼š0è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆã€‚\n\n\n\nåˆ†ææœ¬é¢˜çš„è¦ç‚¹ï¼šæœ€å¤šå…è®¸ä¸€æ¬¡äº¤æ˜“ï¼ˆä¹°å…¥+å–å‡ºï¼‰ã€‚è€Œæ•°ç»„æœ¬èº«çš„é•¿åº¦ï¼Œæ»¡è¶³ prices.length&gt;=1 ï¼Œå³ï¼šä½ æƒ³åœ¨å“ªä¸ªç‚¹ä½ä¹°å…¥ï¼Œéšæ„ä»»å›æŒ‘é€‰~å¹¶ä¸”ï¼Œä½ ä¸ç”¨è€ƒè™‘å½“å‰äº¤æ˜“ä¼šå¯¹ä¸‹æ¬¡äº¤æ˜“äº§ç”Ÿå½±å“ï¼ˆå› ä¸ºåªæœ‰ä¸€æ¬¡äº¤æ˜“ï¼Œä¸å­˜åœ¨ä¸‹ä¸€æ¬¡ï¼‰ã€‚\næ‰€ä»¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸è€ƒè™‘dpæ€æƒ³ï¼Œé€€åŒ–ä¸ºæœ€naiveçš„è´ªå¿ƒç­–ç•¥ï¼šé€‰æ‹©ä¸€ä¸ªä»·æ ¼å·®æœ€å¤§çš„äº¤æ˜“å³å¯ã€‚\n\n\nä»£ç class Solution &#123;  public int maxProfit(int[] prices) &#123;    int min = prices[0], ans = 0;    for (int price : prices) &#123;      min = Math.min(min, price);      ans = Math.max(ans, price - min);    &#125;    return ans;  &#125;&#125;\n\n\n\né¢˜ç›®2 â€“ LeetCode.122é¢˜é¢\nç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ å¯ä»¥ å°½å¯èƒ½åœ° å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› 0 ã€‚æ³¨æ„ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚\n\nç¤ºä¾‹1ï¼š\n\nè¾“å…¥ï¼šprices &#x3D; [7,1,5,3,6,4]è¾“å‡ºï¼š7\n\nç¤ºä¾‹2ï¼š\n\nè¾“å…¥ï¼šprices &#x3D; [1,2,3,4,5]è¾“å‡ºï¼š4\n\n\n\nåˆ†ææœ¬é¢˜çš„è¦ç‚¹ï¼šå…è®¸ä»»æ„å¤šæ¬¡äº¤æ˜“ï¼ˆä¹°å…¥+å–å‡ºï¼‰ã€‚é™¤äº†ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–é™åˆ¶æ¡ä»¶ã€‚\nè¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿå®Œå…¨å¯ä»¥å°†é—®é¢˜ é€€åŒ–ä¸ºè´ªå¿ƒç­–ç•¥ï¼šåªè¦ä»Šå¤©ä»·æ ¼æ¯”æ˜¨å¤©é«˜ï¼Œé‚£ä¹ˆæˆ‘å°±è®¤ä¸ºæ˜¨å¤©å·²ä¹°å…¥ï¼Œç„¶ååœ¨ä»Šå¤©å–å‡ºã€‚\nä¸ºä»€ä¹ˆè¿™ä¸ªç­–ç•¥æ˜¯æ­£ç¡®çš„ï¼Ÿä¸‡ä¸€æ˜å¤©æ›´é«˜ï¼Œä½†æ˜¯æˆ‘ä»Šå¤©å°±å–å‡ºäº†ï¼Œå²‚ä¸æ˜¯å–æ—©äº†å˜›ï¼Ÿï¼Ÿ\nå…¶å®å¹¶ä¸ä¼šã€‚å¯ä»¥çœ‹ ç¤ºä¾‹2 ï¼Œä½ ä¼šå‘ç°ï¼šå³ä½¿æˆ‘åœ¨1å—é’±ä¹°å…¥ã€2å—é’±å–å‡ºï¼›ç„¶åæˆ‘å¯ä»¥åœ¨2å—é’±åˆä¹°å…¥ã€3å—é’±å†å–å‡ºï¼›ç„¶åå†æ˜¯3å—é’±ä¹°å…¥ã€4å—é’±å–å‡ºâ€¦â€¦æ€»ä¹‹ï¼Œæˆ‘æœ€åä¾ç„¶å¯ä»¥èµšå–4å…ƒçš„åˆ©æ¶¦ï¼Œä¸ä¼šå°‘çš„ã€‚å—¯ï¼Œæœ¬è´¨æ˜¯å«æˆ‘ä»¬å»åšçŸ­çº¿é«˜æ‰‹ã€‚æ‡‚äº†ï¼Œå­¦ä¼šè¿™ä¸ªæ“ä½œæ€è·¯ï¼Œè‚¡ç¥å°±æ˜¯åœ¨ä¸‹äº†ã€‚å®é™…ï¼šæ­»äºåšt\n\n\nä»£ç class Solution &#123;  public int maxProfit(int[] prices) &#123;    int cost = prices[0], ans = 0;    for (int price : prices) &#123;      ans += Math.max(price - cost, 0);      cost = price;    &#125;    return ans;  &#125;&#125;\n\n\n\né¢˜ç›®3 â€“ LeetCode.309ï¼šé¢˜é¢\nç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•è®¡ç®—å‡ºæœ€å¤§åˆ©æ¶¦ã€‚åœ¨æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ä¸‹ï¼Œä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰:\n\nä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚\nå–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ (å³å†·å†»æœŸä¸º 1 å¤©)ã€‚è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› 0 ã€‚\n\n\nç¤ºä¾‹1ï¼š\n\nè¾“å…¥ï¼šprices &#x3D; [1,2,3,0,2]è¾“å‡ºï¼š3\n\n\n\nåˆ†ææœ¬é¢˜çš„è¦ç‚¹ï¼šå…è®¸ä»»æ„å¤šæ¬¡äº¤æ˜“ï¼ˆä¹°å…¥+å–å‡ºï¼‰ï¼Œä½†é™¤äº†ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ä»¥å¤–ï¼Œæ¯ä¸¤ç¬”äº¤æ˜“ä¹‹é—´è¿˜å­˜åœ¨ä¸€å¤©çš„å†·å†»æœŸã€‚\nè¿™ç§æƒ…å†µä¸‹ï¼Œè´ªå¿ƒç­–ç•¥å°±ä¸å†å¥½ä½¿äº†ã€‚å› ä¸ºï¼Œä½ å¿…é¡»è€ƒè™‘åˆ°ï¼šå½“å‰çš„äº¤æ˜“ä¼šä½¿å¾—æ˜å¤©æ— æ³•äº¤æ˜“ï¼Œæ‰€ä»¥â€œæ— è„‘çŸ­çº¿â€å¹¶ä¸è§å¾—ä¸€å®šæ­£ç¡®ã€‚ ä»æ­¤å¼€å§‹ï¼Œdpç­–ç•¥æ­£å¼äº®ç›¸~\n\n\nä»£ç class Solution &#123;  public int maxProfit(int[] prices) &#123;    int n = prices.length;    // dp1[i] -&gt; ç¬¬iå¤©æŒæœ‰è‚¡ç¥¨æ—¶ï¼Œå¯è·å¾—çš„æœ€å¤§åˆ©æ¶¦    // dp2[i] -&gt; ç¬¬iå¤©æœªæŒæœ‰è‚¡ç¥¨ä¸”æœªå¤„äºå†·å†»æœŸï¼Œå¯è·å¾—çš„æœ€å¤§åˆ©æ¶¦    // dp3[i] -&gt; ç¬¬iå¤©æœªæŒæœ‰è‚¡ç¥¨ä¸”å¤„äºå†·å†»æœŸï¼Œå¯è·å¾—çš„æœ€å¤§åˆ©æ¶¦    int[] dp1 = new int[n], dp2 = new int[n], dp3 = new int[n];    dp1[0] = -prices[0];    for (int i = 1; i &lt; n; i++) &#123;      dp1[i] = Math.max(dp1[i - 1], dp2[i - 1] - prices[i]);      dp2[i] = Math.max(dp2[i - 1], dp3[i - 1]);      dp3[i] = dp1[i - 1] + prices[i];    &#125;    return Math.max(dp2[n - 1], dp3[n - 1]);  &#125;&#125;\n\n\n\né¢˜ç›®4 â€“ LeetCode.123ï¼šé¢˜é¢\nç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ ä¸¤ç¬” äº¤æ˜“ã€‚æ³¨æ„ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚\n\nç¤ºä¾‹1ï¼š\n\nè¾“å…¥ï¼šprices &#x3D; [3,3,5,0,0,3,1,4]è¾“å‡ºï¼š6\n\nç¤ºä¾‹2ï¼š\n\nè¾“å…¥ï¼šprices &#x3D; [1,2,3,4,5]è¾“å‡ºï¼š4\n\n\n\nåˆ†ææœ¬é¢˜çš„è¦ç‚¹ï¼šæœ€å¤šå…è®¸ä¸¤æ¬¡äº¤æ˜“ï¼ˆä¹°å…¥+å–å‡ºï¼‰ï¼Œå¹¶ä¸”ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ã€‚\nè¿™ç§æƒ…å†µä¸‹ï¼Œè´ªå¿ƒç­–ç•¥ä¹Ÿä¸å†å¥½ä½¿äº†ã€‚åŸå› ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼šä¸€å…±åªæœ‰ä¸¤æ¬¡äº¤æ˜“æœºä¼šï¼Œä½ å¿…é¡»é€‰æ‹©åˆ©æ¶¦æœ€å¤§çš„ä¸¤ç¬”ï¼Œè€Œä¸æ˜¯â€œä¸€é«˜å°±å–â€ï¼Œéšæ„æŒ¥éœæœºä¼šã€‚\n\n\nä»£ç class Solution &#123;  public int maxProfit(int[] prices) &#123;   /**   * åœ¨ä»»æ„ä¸€å¤©ç»“æŸåï¼Œä¼šå¤„äºä»¥ä¸‹äº”ç§çŠ¶æ€ä¸­çš„ä¸€ç§ï¼š   * æœªè¿›è¡Œè¿‡ä»»ä½•æ“ä½œï¼Œæœ€å¤§åˆ©æ¶¦æ°¸è¿œæ˜¯0   * åªè¿›è¡Œè¿‡ä¸€æ¬¡ä¹°å…¥æ“ä½œï¼Œæœ€å¤§åˆ©æ¶¦ä»¥buy1è¡¨ç¤ºï¼›   * è¿›è¡Œè¿‡ä¸€æ¬¡ä¹°å…¥ã€ä¸€æ¬¡å–å‡ºæ“ä½œï¼Œæœ€å¤§åˆ©æ¶¦ä»¥sell1è¡¨ç¤ºï¼›   * è¿›è¡Œè¿‡ä¸¤æ¬¡ä¹°å…¥ã€ä¸€æ¬¡å–å‡ºæ“ä½œï¼Œæœ€å¤§åˆ©æ¶¦ä»¥buy2è¡¨ç¤ºï¼›   * è¿›è¡Œè¿‡ä¸¤æ¬¡ä¹°å…¥ã€ä¸¤æ¬¡å–å‡ºæ“ä½œï¼Œæœ€å¤§åˆ©æ¶¦ä»¥sell2è¡¨ç¤ºã€‚   */   int buy1 = -prices[0], sell1 = 0, buy2 = -prices[0], sell2 = 0;   for (int i = 1, n = prices.length; i &lt; n; i++) &#123;     buy1 = Math.max(buy1, -prices[i]);     sell1 = Math.max(sell1, buy1 + prices[i]);     buy2 = Math.max(buy2, sell1 - prices[i]);     sell2 = Math.max(sell2, buy2 + prices[i]);   &#125;   return sell2;  &#125;&#125;\n\n\n\né¢˜ç›®5 â€“ LeetCode.188ï¼šé¢˜é¢\nç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ k ç¬”äº¤æ˜“ã€‚æ³¨æ„ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚\n\nç¤ºä¾‹1ï¼š\n\nè¾“å…¥ï¼šk &#x3D; 2, prices &#x3D; [2,4,1]è¾“å‡ºï¼š2\n\nç¤ºä¾‹2ï¼š\n\nè¾“å…¥ï¼šk &#x3D; 2, prices &#x3D; [3,2,6,5,0,3]è¾“å‡ºï¼š7\n\n\n\nåˆ†ææœ¬é¢˜ä¸ä¹‹å‰çš„ä¸åŒä¹‹å¤„åœ¨äºï¼šæœ€å¤šå…è®¸ ä¸¤æ¬¡ äº¤æ˜“ï¼ˆä¹°å…¥+å–å‡ºï¼‰ï¼Œå¹¶ä¸”ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ã€‚\næœ¬é¢˜å®è´¨ä¸Šï¼Œå°±æ˜¯ é¢˜ç›®4 â€“ LeetCode.123 çš„æ‰©å±•ç‰ˆæœ¬ï¼šç¡¬ç¼–ç  2 æ¬¡æœºä¼š --&gt;  ä»»æ„ç»™å®šçš„ k æ¬¡æœºä¼šã€‚\nåŒæ ·åœ°ï¼Œè¿™é‡Œä¹Ÿç†åº”æ— æ³•ä½¿ç”¨è´ªå¿ƒç­–ç•¥ã€‚\nä½†äº‹å®ä¸Šï¼Œç”±äº k çš„èŒƒå›´æ˜¯ä»»æ„çš„ï¼Œæ‰€ä»¥æƒ…å†µä¹Ÿä¸å®Œå…¨æ˜¯è¿™æ ·ã€‚ä¾‹å¦‚ï¼šk=9999999ï¼ˆæ­¤å¤„è‡ªè¡Œè„‘è¡¥ä¸€äº¿ä¸ª9â€¦ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸º k æ˜¯æ— é™å¤§çš„ï¼Œæ­¤æ—¶äº¤æ˜“æ¬¡æ•°è§†ä¸ºï¼šä¸å—é™ã€‚\näº‹å®ä¸Šï¼Œåªè¦æœ‰ k &gt;= prices.length / 2 ï¼Œæ­¤æ—¶å°±å¯ä»¥ æ— è§†æ¬¡æ•°é™åˆ¶äº†ï¼Œå› ä¸ºä½ ä¸€å®šæ¥ä¸åŠç”¨å®Œæ‰€æœ‰çš„äº¤æ˜“æœºä¼šï¼å¦‚æœæ²¡æœ‰äº¤æ˜“æ¬¡æ•°é™åˆ¶ï¼Œé‚£ä¹ˆé—®é¢˜åˆå¯ä»¥é€€åŒ–ä¸ºâ€œè´ªå¿ƒç­–ç•¥â€äº†ã€‚ äºæ˜¯é—®é¢˜åˆå˜æˆäº† é¢˜ç›®2 â€“ LeetCode.122 ã€‚\né™¤æ­¤ä»¥å¤–ï¼Œæ™®éæƒ…å†µä¸‹è¿˜æ˜¯éœ€è¦ä½¿ç”¨ dpç­–ç•¥ ã€‚\n\n\nä»£ç class Solution &#123;  public int maxProfit(int k, int[] prices) &#123;    if (prices.length &lt; 2 || k == 0) &#123;      return 0;    &#125;    // å½“å¯æ“ä½œæ¬¡æ•°ä¸å°‘äºæ•°ç»„çš„ä¸€åŠé•¿åº¦æ—¶ï¼Œé—®é¢˜å¯ä»¥é€€åŒ–ä¸ºâ€œè´ªå¿ƒç­–ç•¥â€    if (k &gt;= (prices.length &gt;&gt; 1)) &#123;      return greedy(prices);    &#125;    // dp[i][0] -&gt; å®Œæˆiæ¬¡ä¹°å…¥åï¼Œå¯è·å¾—çš„æœ€å¤§åˆ©æ¶¦    // dp[i][1] -&gt; å®Œæˆiæ¬¡å–å‡ºåï¼Œå¯è·å¾—çš„æœ€å¤§åˆ©æ¶¦    int[][] dp = new int[k][2];    for (int i = 0; i &lt; k; i++) &#123;      dp[i][0] = -prices[0];    &#125;    for (int price : prices) &#123;      dp[0][0] = Math.max(dp[0][0], -price);      dp[0][1] = Math.max(dp[0][1], dp[0][0] + price);      for (int i = 1; i &lt; k; i++) &#123;        dp[i][0] = Math.max(dp[i][0], dp[i - 1][1] - price);        dp[i][1] = Math.max(dp[i][1], dp[i][0] + price);      &#125;    &#125;    return dp[k - 1][1];  &#125;  private int greedy(int[] prices) &#123;    int cost = prices[0], ans = 0;    for (int price : prices) &#123;      ans += Math.max(price - cost, 0);      cost = price;    &#125;    return ans;  &#125;&#125;","tags":["ç®—æ³•","åŠ¨æ€è§„åˆ’"]},{"title":"ã€Œæ ‘ã€æ ¹æ®ç»™å®šçš„å‰/ä¸­/ååºéå†ï¼Œä»¥æ¢å¤äºŒå‰æ ‘","url":"/2022/03/12/%E3%80%8C%E6%A0%91%E3%80%8D%E6%A0%B9%E6%8D%AE%E7%BB%99%E5%AE%9A%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E6%81%A2%E5%A4%8D%E4%BA%8C%E5%8F%89%E6%A0%91/","content":"ä»Šå¤©æ¥è®°å½•ä¸¤é“ç»å…¸äºŒå‰æ ‘çš„é—®é¢˜ï¼š\n\nLeetCode.105 â€“ ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘\n\nLeetCode.106 â€“ ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘\n\n\n\né¦–å…ˆï¼Œä¸ºäº†æ„å»ºå‡ºè¿™æ£µäºŒå‰æ ‘ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯è‡ªé¡¶å‘ä¸‹ï¼Œä» ä½äºé¡¶ç«¯çš„æ ‘æ ¹èŠ‚ç‚¹ å‡ºå‘ï¼Œåœ¨æ¯ä¸ªæ­£ç¡®çš„ä½ç½®æ„é€ å‡ºæ­£ç¡®çš„èŠ‚ç‚¹ã€‚åœ¨æ¯æ¬¡å¤„ç†ä¸­ï¼Œæˆ‘ä»¬åªå…³æ³¨å¦‚ä½• æ„é€ å‡ºå½“å‰èŠ‚ç‚¹ ã€‚\nè€Œè¿™ä¸ª èŠ‚ç‚¹ ï¼š\n\nå¯¹äº å…ˆåºéå† ï¼Œå°±æ˜¯ ç¬¬ä¸€ä¸ª å…ƒç´  preorder[preLeft] ï¼›\n\nå¯¹äº ååºéå† ï¼Œå°±æ˜¯ æœ€åä¸€ä¸ª å…ƒç´  postorder[postRight]\n\n\nç°åœ¨ï¼Œè¿™ä¸ªæ ¹èŠ‚ç‚¹çš„ val å±æ€§å·²ç»ç¡®å®šäº†ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡ºå½“å‰èŠ‚ç‚¹ï¼š TreeNode root = new TreeNode(val);\nä½†æ˜¯å…¶ left å’Œ right å±æ€§éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œå®ƒä»¬ä½œä¸ºå­èŠ‚ç‚¹ï¼Œæ­¤æ—¶å¹¶ä¸å­˜åœ¨ã€‚éœ€è¦åœ¨ä¹‹åçš„å¤„ç†ä¸­å°†å®ƒä»¬æ„é€ å‡ºæ¥ (ä¹Ÿå°±æ˜¯é€’å½’è°ƒç”¨) ï¼š \nroot.left = buildTree();root.right = buildTree();\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¼€å§‹åˆ©ç”¨ ä¸­åºéå†çš„æ€§è´¨ã€‚æ®å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® å…ˆåºéå† (or ååºéå†) å¾—åˆ°å½“å‰çš„æ ¹èŠ‚ç‚¹ã€‚é‚£ä¹ˆï¼Œå®ƒåœ¨ ä¸­åºéå† ä¸­çš„ä½ç½®ï¼Œå…¶å®å°†æ•´æ£µæ ‘åˆ†ä¸ºäº†ä¸¤åŠã€‚\næˆ‘ä»¬å‡å®š è¯¥æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸­çš„ä½ç½® æ˜¯ rootIdx ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯çŸ¥ å·¦å­æ ‘çš„èŠ‚ç‚¹ä¸ªæ•° leftSize = rootIdx - inLeft ï¼Œç”±æ­¤å¯å¾—åˆ°å·¦å³å­æ ‘çš„åŒºé—´èŒƒå›´ï¼š\n\nå·¦å­æ ‘ï¼š\nå…ˆåºéå†ï¼š [preLeft + 1, preLeft + leftSize]\nä¸­åºéå†ï¼š [inLeft, rootIdx - 1]\nååºéå†ï¼š [postLeft, postLeft + leftSize - 1]\n\n\nå³å­æ ‘ï¼š\nå…ˆåºéå†ï¼š [preLeft + leftSize + 1, preRight]\nä¸­åºéå†ï¼š [rootIdx + 1, inRight]\nååºéå†ï¼š [postLeft + leftSize, postRight - 1]\n\n\n\nè‡³äºå¦‚ä½•èƒ½å¿«é€Ÿåœ°æ ¹æ®å…ˆåºéå†&#x2F;ååºéå†çš„å…ƒç´ å®šä½è‡³å®ƒåœ¨ä¸­åºéå†ä¸­çš„ä½ç½®ï¼Ÿ\nç­”æ¡ˆæ˜¯ï¼šåœ¨å¼€å§‹æ—¶ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨æ¥é¢„å¤„ç†å­˜å‚¨å…ˆ&#x2F;ååºéå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åœ¨ä¸­åºéå†æ•°ç»„ä¸­çš„ä½ç½®ã€‚\n\n\nLeetCode.105 â€“ ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ä»£ç class Solution &#123;    private int n;  private Map&lt;Integer, Integer&gt; map;  public TreeNode buildTree(int[] preorder, int[] inorder) &#123;    this.n = preorder.length;    this.map = new HashMap&lt;&gt;(n);    for (int i = 0; i &lt; n; i++) &#123;      map.put(inorder[i], i);    &#125;    return buildTree(preorder, 0, n - 1, inorder, 0, n - 1);  &#125;  private TreeNode buildTree(int[] preorder, int preLeft, int preRight, int[] inorder, int inLeft, int inRight) &#123;    if (preLeft &gt; preRight || inLeft &gt; inRight) &#123;      return null;    &#125;    int rootVal = preorder[preLeft], rootIdx = map.get(rootVal);    TreeNode root = new TreeNode(rootVal);    root.left = buildTree(preorder, preLeft + 1, preLeft + rootIdx - inLeft, inorder, inLeft, rootIdx - 1);    root.right = buildTree(preorder, preLeft + rootIdx - inLeft + 1, preRight, inorder, rootIdx + 1, inRight);    return root;  &#125;&#125;\n\n\n\nLeetCode.106 â€“ ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ä»£ç class Solution &#123;    private int n;  private Map&lt;Integer, Integer&gt; map;  public TreeNode buildTree(int[] inorder, int[] postorder) &#123;    this.n = inorder.length;    this.map = new HashMap&lt;&gt;(n);    for (int i = 0; i &lt; n; i++) &#123;      map.put(inorder[i], i);    &#125;    return buildTree(inorder, 0, n - 1, postorder, 0, n - 1);  &#125;  private TreeNode buildTree(int[] inorder, int inLeft, int inRight, int[] postorder, int postLeft, int postRight) &#123;    if (inLeft &gt; inRight || postLeft &gt; postRight) &#123;      return null;    &#125;    int rootVal = postorder[postRight], rootIdx = map.get(rootVal);    TreeNode root = new TreeNode(rootVal);    root.left = buildTree(inorder, inLeft, rootIdx - 1, postorder, postLeft, postLeft + rootIdx - inLeft - 1);    root.right = buildTree(inorder, rootIdx + 1, inRight, postorder, postLeft + rootIdx - inLeft, postRight - 1);    return root;  &#125;&#125;","tags":["ç®—æ³•","äºŒå‰æ ‘"]},{"title":"ã€Œé“¾è¡¨ã€é“¾è¡¨é¢˜æ€»ç»“","url":"/2022/03/27/%E3%80%8C%E9%93%BE%E8%A1%A8%E3%80%8D%E9%93%BE%E8%A1%A8%E9%A2%98%E6%80%BB%E7%BB%93/","content":"é“¾è¡¨çš„åŸºæœ¬å¥—è·¯ï¼šé“¾è¡¨åè½¬public ListNode reverseList(ListNode head) &#123;  if (head == null || head.next == null) &#123;    return head;  &#125;  // ä¸‰æŒ‡é’ˆ  ListNode prev = null, cur = head;  while (cur != null) &#123;    ListNode temp = cur.next;    cur.next = prev;    prev = cur;    cur = temp;  &#125;  return prev;&#125;\n\n\næ‰¾é“¾è¡¨çš„ä¸­ç‚¹public ListNode middleNode(ListNode head) &#123;  // å¿«æ…¢åŒæŒ‡é’ˆ  ListNode slow = head, fast = head;  while (fast.next != null &amp;&amp; fast.next.next != null) &#123;    slow = slow.next;    fast = fast.next.next;  &#125;  // è‡³æ­¤ï¼Œslow ç§»åŠ¨è‡³é“¾è¡¨çš„ä¸­ç‚¹  // å¯¹äºé•¿åº¦ä¸ºå¥‡æ•°çš„é“¾è¡¨ï¼Œä¸­ç‚¹åªæœ‰ä¸€ä¸ª  // å¯¹äºé•¿åº¦ä¸ºå¶æ•°çš„é“¾è¡¨ï¼Œä¸­ç‚¹æœ‰ä¸¤ä¸ªã€‚æ­¤æ—¶ slow ä½äºç¬¬ä¸€ä¸ªä¸­ç‚¹  return slow;&#125;\n\n\næ‰¾é“¾è¡¨çš„å€’æ•°ç¬¬ K ä¸ªèŠ‚ç‚¹ (ä½¿ç”¨å‰ååŒæŒ‡é’ˆ former, latter )public ListNode kthToLast(ListNode head, int k) &#123;  ListNode former = head, latter = head;  // è®©å…ˆæŒ‡é’ˆ former å…ˆèµ° k æ­¥  for (int i = 0; i &lt; k; i++) &#123;    former = former.next;  &#125;  while (former != null) &#123;    former = former.next;    latter = latter.next;  &#125;  return latter;&#125;\n\n\nåˆ é™¤æŸèŠ‚ç‚¹// æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ prevprev.next = prev.next.next\n\n\n\nå¾ˆå¤šé“¾è¡¨çš„ä¸­ç­‰é¢˜ç”šè‡³æ˜¯å›°éš¾é¢˜ï¼Œå…¶å®éƒ½æ˜¯å¯¹äºä¸Šè¿°åŸºæœ¬å¥—è·¯çš„ç¼åˆã€‚\nä¾‹å¦‚ï¼ŒLeetCode.234 â€“ åˆ¤æ–­ä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡é“¾è¡¨ ã€‚\n\nå¾ˆç›´è§‚çš„ä¸€ä¸ªåšæ³•æ˜¯ï¼šä½¿ç”¨ æ ˆ çš„æ•°æ®ç»“æ„ï¼Œå…ˆå­˜å‚¨é“¾è¡¨çš„å‰åŠéƒ¨åˆ†ï¼Œç„¶åä¸ååŠéƒ¨åˆ†é€ä¸ªè¿›è¡Œæ¯”å¯¹ã€‚ä½†æ˜¯è¿™ä¹ˆåšçš„è¯ï¼Œç©ºé—´å¤æ‚åº¦å°±æ˜¯ O(n) äº†ã€‚\nå­˜åœ¨ä¸€ç§ç©ºé—´å¤æ‚åº¦ O(1) çš„åŸåœ°è§£æ³•ï¼Œå³ç”¨åˆ°æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„åŸºæœ¬å¥—è·¯æ“ä½œã€‚\nå…·ä½“åšæ³•æ˜¯ï¼š\n\nä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå®šä½è‡³é“¾è¡¨çš„ä¸­ç‚¹\nåè½¬ååŠéƒ¨åˆ†çš„é“¾è¡¨\næ¯”è¾ƒå‰åŠéƒ¨åˆ†ä¸ååŠéƒ¨åˆ†çš„é“¾è¡¨æ˜¯å¦å®Œå…¨ä¸€è‡´public boolean isPalindrome(ListNode head) &#123;  // å®šä½è‡³é“¾è¡¨çš„ä¸­ç‚¹  ListNode slow = head, fast = head;  while (fast.next != null &amp;&amp; fast.next.next != null) &#123;    slow = slow.next;    fast = fast.next.next;  &#125;  // åè½¬ååŠéƒ¨åˆ†çš„é“¾è¡¨  ListNode prev = null, cur = slow.next;  while (cur != null) &#123;    ListNode temp = cur.next;    cur.next = prev;    prev = cur;    cur = temp;  &#125;  // æ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨  ListNode ptr1 = head, ptr2 = prev;  while (ptr2 != null) &#123;    if (ptr1.val != ptr2.val) &#123;      return false;    &#125;    ptr1 = ptr1.next;    ptr2 = ptr2.next;  &#125;  return true;&#125;\n\n\n\nå¸¸è§é“¾è¡¨é¢è¯•é¢˜åè½¬é“¾è¡¨public ListNode reverseList(ListNode head) &#123;  if (head == null || head.next == null) &#123;    return head;  &#125;  ListNode prev = null, cur = head;  while (cur != null) &#123;    ListNode temp = cur.next;    cur.next = prev;    prev = cur;    cur = temp;  &#125;  return prev;&#125;\n\n\nKä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨public ListNode reverseKGroup(ListNode head, int k) &#123;  // åˆ¤æ–­å‰©ä½™èŠ‚ç‚¹ä¸ªæ•°æ˜¯å¦å¤Ÿ k ä¸ª  ListNode cur = head;  for (int i = 0; i &lt; k; i++) &#123;    if (cur == null) &#123;      return head;    &#125;    cur = cur.next;  &#125;  // ç¿»è½¬æ¥ä¸‹æ¥çš„ k ä¸ªèŠ‚ç‚¹  ListNode prev = null;  cur = head;  for (int i = 0; i &lt; k; i++) &#123;    ListNode temp = cur.next;    cur.next = prev;    prev = cur;    cur = temp;  &#125;  // å°¾éƒ¨è¿æ¥  head.next = reverseKGroup(cur, k);  return prev;&#125;\n\n\nåˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨public ListNode mergeTwoLists(ListNode list1, ListNode list2) &#123;  if (list1 == null) &#123;    return list2;  &#125;  if (list2 == null) &#123;    return list1;  &#125;  if (list1.val &lt;= list2.val) &#123;    list1.next = mergeTwoLists(list1.next, list2);    return list1;  &#125;  list2.next = mergeTwoLists(list1, list2.next);  return list2;&#125;\nå¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿­ä»£æ³• (ç±»ä¼¼äºå½’å¹¶æ’åº) ã€‚\nåˆ¤æ–­æ˜¯å¦ä¸ºç¯å½¢é“¾è¡¨public boolean hasCycle(ListNode head) &#123;  ListNode slow = head, fast = head;  while (fast != null &amp;&amp; fast.next != null) &#123;    slow = slow.next;    fast = fast.next.next;    if (slow == fast) &#123;      return true;    &#125;  &#125;  return false;&#125;\n\nå»¶ä¼¸é—®é¢˜ï¼š æ‰¾åˆ°ç¯çš„å…¥å£èŠ‚ç‚¹\n\npublic ListNode detectCycle(ListNode head) &#123;  if (head == null) &#123;    return null;  &#125;  boolean hasCycle = false;  ListNode slow = head, fast = head;  while (fast != null &amp;&amp; fast.next != null) &#123;    slow = slow.next;    fast = fast.next.next;    if (slow == fast) &#123;      hasCycle = true;      break;    &#125;  &#125;  if (!hasCycle) &#123;    return null;  &#125;  slow = head;  while (slow != fast) &#123;    slow = slow.next;    fast = fast.next;  &#125;  return slow;&#125;\n\n\nç›¸äº¤é“¾è¡¨public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123;  int lenA = getLen(headA), lenB = getLen(headB);  if (lenB &gt; lenA) &#123;    return getIntersectionNode(headB, headA);  &#125;  // ä¿è¯ä¸¤ä¸ªé“¾è¡¨çš„å‰©ä½™é•¿åº¦ä¸€è‡´  while (lenA &gt; lenB) &#123;    headA = headA.next;    lenA--;  &#125;  while (headA != headB) &#123;    headA = headA.next;    headB = headB.next;  &#125;  return headA;&#125;private int getLen(ListNode head) &#123;  int ans = 0;  while (head != null) &#123;    head = head.next;    ans++;  &#125;  return ans;&#125;\n\n\né“¾è¡¨ç›¸åŠ public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123;  if (l1 == null) &#123;    return l2;  &#125;  // ä¸è¶³è¡¥0  if (l2 == null) &#123;    l2 = new ListNode(0);  &#125;  l1.val += l2.val;  // å­˜åœ¨è¿›ä½ç°è±¡  if (l1.val &gt;= 10) &#123;    l1.val -= 10;    if (l1.next == null) &#123;      l1.next = new ListNode(0);    &#125;    l1.next.val++;    &#125;  &#125;  l1.next = addTwoNumbers(l1.next, l2.next);  return l1;&#125;\n\n\né‡æ’é“¾è¡¨public void reorderList(ListNode head) &#123;  if (head == null || head.next == null) &#123;    return;  &#125;  // æ‰¾åˆ°é“¾è¡¨çš„ä¸­ç‚¹  ListNode slow = head, fast = head;  while (fast.next != null &amp;&amp; fast.next.next != null) &#123;    slow = slow.next;    fast = fast.next.next;  &#125;  // ç”±æ­¤ï¼Œå°†æ•´ä¸ªé“¾è¡¨åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚  // å‰åŠéƒ¨åˆ†æ˜¯ [head,mid] ï¼›ååŠéƒ¨åˆ†æ˜¯ [mid.next,end]  ListNode mid = slow, cur = mid.next;  mid.next = null;  // åè½¬ååŠéƒ¨åˆ†çš„é“¾è¡¨  ListNode prev = null;  while (cur != null) &#123;    ListNode temp = cur.next;    cur.next = prev;    prev = cur;    cur = temp;  &#125;  // åˆå¹¶ä¸¤ä¸ªé“¾è¡¨  ListNode ptr1 = head, ptr2 = prev;  while (ptr1 != null &amp;&amp; ptr2 != null) &#123;    ListNode temp1 = ptr1.next, temp2 = ptr2.next;    ptr1.next = ptr2;    ptr2.next = temp1;    ptr1 = temp1;    ptr2 = temp2;  &#125;&#125;\n\n\nåˆ é™¤é“¾è¡¨çš„é‡å¤å…ƒç´ public ListNode deleteDuplicates(ListNode head) &#123;  if (head == null || head.next == null) &#123;    return head;  &#125;  ListNode prev = new ListNode(-200, head), cur = prev;  while (cur.next != null) &#123;    // å»é‡    if (cur.val == cur.next.val) &#123;      cur.next = cur.next.next;    &#125; else &#123;      cur = cur.next;    &#125;  &#125;  return prev.next;&#125;\n\n\nä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹public ListNode swapPairs(ListNode head) &#123;  if (head == null || head.next == null) &#123;    return head;  &#125;  ListNode first = head, second = first.next, third = second.next;  second.next = first;  first.next = swapPairs(third);  return second;&#125;\n\n\né“¾è¡¨æ’åºpublic ListNode sortList(ListNode head) &#123;  if (head == null) &#123;    return null;  &#125;  return mergeSort(head);&#125;private ListNode mergeSort(ListNode head) &#123;  if (head.next == null) &#123;    return head;  &#125;  ListNode pre = null, ptr1 = head, ptr2 = head;  while (ptr2 != null &amp;&amp; ptr2.next != null) &#123;    pre = ptr1;    ptr1 = ptr1.next;    ptr2 = ptr2.next.next;  &#125;  pre.next = null;  ListNode left = mergeSort(head);  ListNode right = mergeSort(ptr1);  return merge(left, right);&#125;private ListNode merge(ListNode left, ListNode right) &#123;  ListNode dummy = new ListNode(-1), cur = dummy;  while (left != null &amp;&amp; right != null) &#123;    if (left.val &lt;= right.val) &#123;      cur.next = left;      cur = cur.next;      left = left.next;    &#125; else &#123;      cur.next = right;      cur = cur.next;      right = right.next;    &#125;  &#125;  if (left != null) &#123;    cur.next = left;  &#125;  if (right != null) &#123;    cur.next = right;  &#125;  return dummy.next;&#125;\n\n\nåˆ†éš”é“¾è¡¨public ListNode partition(ListNode head, int x) &#123;  ListNode dummy1 = new ListNode(-1), dummy2 = new ListNode(-1);  ListNode ptr1 = dummy1, ptr2 = dummy2;  while (head != null) &#123;    if (head.val &lt; x) &#123;      ptr1.next = head;      head = head.next;      ptr1 = ptr1.next;      ptr1.next = null;    &#125; else &#123;      ptr2.next = head;      head = head.next;      ptr2 = ptr2.next;      ptr2.next = null;    &#125;  &#125;  ptr1.next = dummy2.next;  return dummy1.next;&#125;","tags":["ç®—æ³•","é“¾è¡¨"]},{"title":"ã€Œå¤šçº¿ç¨‹ã€ æ—¶é—´ç®¡ç†å¤§å¸ˆ","url":"/2022/05/17/%E3%80%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E3%80%8D%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86%E5%A4%A7%E5%B8%88%E7%A8%8B%E5%BA%8F%E6%8C%87%E5%8D%97/","content":"çº¿ç¨‹çº¿ç¨‹çš„å‡ ç§çŠ¶æ€ï¼Ÿ\næ–°å»º New\nå°±ç»ª Runnable\nè¿è¡Œ Running\né˜»å¡ Blocked\nI&#x2F;O ï¼šé˜»å¡æ€ï¼Œä»…é‡Šæ”¾CPUèµ„æºï¼Œä½†ä¸ä¼šé‡Šæ”¾å æœ‰ç€çš„é”ã€‚å¦‚ sleep()\nWaiting ï¼šç­‰å¾…æ€ï¼Œä¼šé‡Šæ”¾CPUèµ„æºå’Œå æœ‰ç€çš„é”ã€‚å¦‚ wait()\nTimed Waiting ï¼šå¸¦æœ‰è¶…æ—¶çš„ç­‰å¾…æ€\n\n\nç»“æŸ Terminated\n\n\n\nçº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\né¦–å…ˆï¼Œå¯ä»¥ä»å®è§‚çš„è§’åº¦çœ‹å¾…å®ƒä»¬çš„å…³ç³»ï¼šä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚\nè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´æ˜¯ä¸å…±äº«èµ„æºçš„ã€‚å¦‚æœéœ€è¦ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨é€šä¿¡æŠ€æœ¯ï¼ˆsocketã€channelï¼‰ã€‚\nçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºè°ƒåº¦çš„æœ€å°å•å…ƒã€‚é™¤äº†çº¿ç¨‹è‡ªå·±çš„å‡½æ•°å †æ ˆç­‰ï¼Œçº¿ç¨‹ä¸çº¿ç¨‹ä¹‹é—´æ˜¯å…±äº«èµ„æºçš„ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨è¿™ä¸€é—®é¢˜ï¼‰ã€‚\næ‰“ä¸ªæ¯”å–»ï¼šè¿›ç¨‹æ˜¯æ°´æ¯ï¼Œçº¿ç¨‹æ˜¯æ°´æ¯é‡Œçš„æ°´ã€‚äººå–çš„æ˜¯æ°´è€Œä¸æ˜¯æ°´æ¯ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ°´æ¯æ¥è£…æ°´ä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚\n\nè¿›ç¨‹å¯ä»¥çœ‹ä½œæ˜¯é‡é‡çº§çš„çº¿ç¨‹ã€‚åœ¨å¤šä»»åŠ¡å¤„ç†æœºçš„ç¯å¢ƒä¸‹ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨è¿›ç¨‹ä½œä¸ºè°ƒåº¦å•å…ƒï¼Œé‚£ä¹ˆåœ¨èµ„æºåˆ‡æ¢æ—¶çš„å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ã€‚ä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥å¼•å…¥äº†çº¿ç¨‹æ¥å–ä»£è¿›ç¨‹çš„èµ„æºè°ƒåº¦åŠŸèƒ½ã€‚\n\n\n\n\nä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆï¼Ÿå› ä¸ºå¤šçº¿ç¨‹æ˜¯å…±ç”¨è®¡ç®—æœºä¸Šçš„CPUèµ„æºçš„ï¼Œå¹¶ä¸”åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ•°éƒ½æ˜¯å¤§äºCPUæ ¸å¿ƒæ•°çš„ã€‚ä¸ºäº†è®©æ‰€æœ‰çº¿ç¨‹éƒ½æœ‰æ‰§è¡Œçš„æœºä¼šï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦åˆ‡æ¢ã€‚è¿™ç§åˆ‡æ¢å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚åœ¨åˆ‡æ¢å‰ï¼Œéœ€è¦ä¿å­˜CPUçš„çŠ¶æ€ï¼›åœ¨åˆ‡æ¢å›æ¥åï¼Œåˆéœ€è¦æ¢å¤CPUçš„çŠ¶æ€ï¼Œä½¿å¾—çº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®åœ°ä»ä¸­æ–­å¤„æ¢å¤æ‰§è¡Œã€‚\nåœ¨Javaä¸­ï¼Œçº¿ç¨‹è°ƒåº¦é‡‡ç”¨çš„æ˜¯æŠ¢å å¼çš„æ–¹å¼ã€‚ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡åˆ°åï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®çº¿ç¨‹ä¼˜å…ˆçº§ã€çº¿ç¨‹é¥¥é¥¿æƒ…å†µã€CPUç©ºé—²ç‡ç­‰å¤šæ–¹é¢å› ç´ ï¼Œé€‰å‡ºä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶åˆ†é…æ—¶é—´ç‰‡ç»™å®ƒã€‚\nå¯ä»¥é€šè¿‡ setPriority() æ¥è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ä¸è¿‡ï¼Œä½ ä¸èƒ½æŒ‡æœ›é å®ƒæ¥ä¿è¯ï¼Œå› ä¸ºæœ€ç»ˆæƒè¿˜æ˜¯åœ¨åº•å±‚çš„æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«éœ€æ±‚ï¼Œå°±ä¸è¦æ”¹åŠ¨çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå› ä¸ºè®¾ç½®ä¸å½“ï¼Œé€ æˆçº¿ç¨‹é¥¥é¥¿é—®é¢˜ï¼ˆå½“å‰çº¿ç¨‹è¢«ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹åå™¬æ‰äº†æ‰€æœ‰çš„CPUæ—¶é—´ï¼‰ã€‚\n\n\nä»€ä¹ˆæ˜¯çº¿ç¨‹é¥¥é¥¿ï¼Ÿçº¿ç¨‹é¥¥é¥¿æŒ‡çš„æ˜¯ï¼šä¸€ä¸ªçº¿ç¨‹å› ä¸ºæŸç§åŸå› æ— æ³•è·å¾—æ‰€éœ€èµ„æºï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•æ‰§è¡Œä¸‹å»ã€‚\n\n\nå¬èµ·æ¥å’Œæ­»é”æœ‰ç‚¹åƒï¼šæ­»é”æ˜¯æŒ‡ä¸¤ä¸ªåŠä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ï¼Œå› äº’ç›¸éœ€è¦å¯¹æ–¹çš„èµ„æºï¼Œå´åˆä¸è‚¯å…ˆé‡Šæ”¾è‡ªå·±æŒæœ‰çš„èµ„æºï¼Œå¯¼è‡´å…¨éƒ½æ°¸è¿œç­‰å¾…åœ¨åŸåœ°ã€‚\næ­»é”å’Œé¥¥é¥¿çš„ç›¸åŒç‚¹æ˜¯ï¼šäºŒè€…éƒ½æ˜¯å› ä¸ºèµ„æºçš„ç«äº‰å¼•èµ·çš„é—®é¢˜ã€‚\næ­»é”å’Œé¥¥é¥¿çš„ä¸åŒç‚¹æ˜¯ï¼š\n\nåœ¨æ­»é”ä¸­ï¼Œèµ„æºçš„å æœ‰æ–¹å’Œèµ„æºçš„æ‹¥æœ‰æ–¹äº’ç›¸è¯·æ±‚å¯¹æ–¹çš„èµ„æºï¼›åœ¨é¥¥é¥¿ä¸­ï¼Œå½“å‰çº¿ç¨‹åªæ˜¯è¿Ÿè¿Ÿå¾—ä¸åˆ°æ‰€éœ€èµ„æºï¼Œä½†æ˜¯å¹¶ä¸åœ¨ä¹è¿™ä¸ªèµ„æºæ˜¯è°ç»™çš„ï¼\næ­»é”ä¸€å®šæ¶‰åŠå¤šä¸ªçº¿ç¨‹ï¼Œè€Œé¥¥é¥¿å¯èƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚\nå½“é¥¥é¥¿å‘ç”Ÿæ—¶ï¼Œé™¤äº†é¥¥é¥¿çº¿ç¨‹å¾—ä¸åˆ°æ‰§è¡Œæœºä¼šï¼Œå…¶ä»–çº¿ç¨‹éƒ½è¿˜æ˜¯æ­£å¸¸æ‰§è¡Œçš„ï¼›å½“æ­»é”å‘ç”Ÿæ—¶ï¼Œå¯èƒ½æœ€ç»ˆä¼šä½¿æ•´ä¸ªç³»ç»Ÿéƒ½é™·å…¥æ­»é”å¹¶å´©æºƒã€‚\n\n\n\nCallable å’Œ Future çš„åŒºåˆ«ï¼ŸCallable æ¥å£ç±»ä¼¼äº Runnable (ä»åå­—ä¹Ÿå¯ä»¥çœ‹å¾—å‡º) ï¼Œä¸è¿‡ Runnable ä¸ä¼šè¿”å›æ‰§è¡Œç»“æœï¼Œä¹Ÿæ— æ³•æŠ›å‡ºè¿”å›ç»“æœçš„å¼‚å¸¸ã€‚ä½†æ˜¯ Callable å°±å¼¥è¡¥äº†è¿™ä¸€ç¼ºé™·ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å¸¦æœ‰å›è°ƒåŠŸèƒ½çš„ Runnable ï¼šèƒ½å¤Ÿè¿”å›å¼‚æ­¥æ‰§è¡Œçš„ç»“æœï¼Œç„¶åç”± Future æ¥æ”¶åˆ°ã€‚\n\n\nçº¿ç¨‹ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿ\nä½¿ç”¨ Object ç±»ä¸­æä¾›çš„ wait() &amp; notify()/notifyAll() ã€park() &amp; unpark() æœºåˆ¶\nä½¿ç”¨ concurrent åŒ…ä¸‹çš„åŒæ­¥å·¥å…·ç±»ï¼Œå¦‚ CountDownLatch ã€CyclicBarrier ã€‚\n\n\n\nä¸ºä»€ä¹ˆè¦æŠŠ wait()ã€notify() è¿™ç§æ–¹æ³•å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Ÿ\nJava ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Monitor å¯¹è±¡ã€‚å½“è¯¥å¯¹è±¡è°ƒç”¨äº† wait()ã€notify() è¿™äº›æ–¹æ³•æ—¶ï¼Œå…¶å®å°±æ˜¯åœ¨å‘ Monitor å¯¹è±¡ä¼ è¾¾ä¿¡æ¯ï¼šç­‰å¾…å¯¹è±¡çš„é” &#x2F; é€šçŸ¥å…¶ä»–çº¿ç¨‹å¯¹è±¡çš„ Monitor æ˜¯å¯ç”¨çš„ã€‚\nåœ¨ Java çš„çº¿ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰æä¾›çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ã€‚ä¸ºäº†ä½¿å¾—æ¯ä¸ªç±»éƒ½å…·æœ‰çº¿ç¨‹é—´é€šä¿¡çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ç»™æ¯ä¸ªç±»éƒ½åº”è¯¥æä¾›ä¸€ä¸ªç±»ä¼¼ wait() ã€ notify()/notifyAll() çš„æ–¹æ³•ã€‚è€Œ Object ä½œä¸ºæ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œå°†è¿™æ ·çš„æ–¹æ³•ç›´æ¥æ”¾åœ¨ Object ä¸­ä¹Ÿæ˜¯ååˆ†åˆé€‚çš„ã€‚\n\n\n\nä¿è¯çº¿ç¨‹å®‰å…¨çš„æ–¹æ¡ˆï¼Ÿ\nä½¿ç”¨ synchronized å…³é”®å­—\n\nä½¿ç”¨ Lock æ¥å£ä¸‹çš„å®ç°ç±»\n\nä½¿ç”¨çº¿ç¨‹çš„æœ¬åœ°å±€éƒ¨å˜é‡ ThreadLocal\nç®€å•æ¥è¯´å°±æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ•°æ®éš”ç¦»æ€æƒ³ï¼šåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­ï¼Œç»´æŠ¤äº†ä¸€ä¸ª ThreadLocalMapï¼Œç”¨ set() &#x2F; get() æ¥ä½¿ç”¨å½“å‰çº¿ç¨‹çš„æ•°æ®ï¼Œæœ€åå°†è¿™ä¸ª Map æŒ‚åˆ°å½“å‰çº¿ç¨‹ä¸‹ï¼Œæ‰€ä»¥ Map å°±åªå±äºè¿™ä¸ªçº¿ç¨‹äº†ã€‚æ•°æ®ä¸å†å…±äº«ï¼Œè‡ªç„¶å°±ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨çš„é—®é¢˜äº†ã€‚\n\nå°†å¯¹è±¡è®¾ç½®ä¸ºä¸å¯å˜çš„ (å³å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¸èƒ½å†æ”¹å˜äº†)\næ¯”å¦‚ Stringã€åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ï¼Œè¿™äº›éƒ½æ˜¯ä¸å¯å˜ç±» (è¢« final ä¿®é¥°) ã€‚\n\nå¦è¾Ÿç©ºé—´ï¼Œåœ¨æ“ä½œç»“æŸåæ›¿æ¢å¼•ç”¨åœ°å€ (å¦‚ CopyOnWriteArrayList)\n\n\n\n\nçº¿ç¨‹æ± ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ï¼Ÿç›´æ¥ new Thread() ä¸å¥½å—ï¼Ÿ\nåˆ›å»ºçº¿ç¨‹å¯¹è±¡æ˜¯ä¸€ä¸ªå¼€é”€è¾ƒå¤§çš„æ“ä½œï¼Œæ— è®ºæ˜¯å¯¹CPUè¿˜æ˜¯å¯¹å†…å­˜å ç”¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡å°±å¼€è¾Ÿä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œæ€§ä»·æ¯”å®åœ¨æ˜¯å¤ªä½äº†ã€‚\n\né€šè¿‡ new Thread() å¾—åˆ°çš„çº¿ç¨‹æ˜¯ä¸æ˜“ç®¡ç†çš„ï¼ˆä¸€èˆ¬è¢«ç§°ä¸ºé‡çº¿ç¨‹ï¼‰ï¼Œç”šè‡³å¯ä»¥æ— é™åˆ¶çš„åˆ›å»ºï¼å¦‚æ­¤ä¸€æ¥ï¼Œå¦‚æœä½¿ç”¨è€…ä½¿ç”¨ä¸æ…ï¼Œå¯èƒ½å°±å¯¼è‡´æ•´ä¸ªæ“ä½œç³»ç»Ÿç˜«ç—ªäº†â€¦â€¦ğŸ™ƒ\n\né€šè¿‡ new Thread() å¾—åˆ°çš„çº¿ç¨‹ä¹Ÿä¸æ˜“äºæ‰©å±•ã€‚æ¯”å¦‚ï¼Œæƒ³è¦å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œçš„è¯ï¼Œéƒ½æ˜¯ä¸å®¹æ˜“å®ç°çš„ã€‚\n\n\n\n\nå› æ­¤ï¼Œå¼•å…¥äº†ä¸€ä¸ªåä¸ºçº¿ç¨‹æ± çš„æ€æƒ³ï¼Œå®Œç¾è§£å†³äº†ä¸Šè¿°ç¼ºç‚¹ã€‚\n\nå¤ç”¨å·²åˆ›å»ºå¥½çš„é‚£äº›çº¿ç¨‹ï¼Œä»è€Œé™ä½äº†èµ„æºæ¶ˆè€—ï¼Œå¹¶ä¸”ä¾¿äºç®¡ç†\nå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œè¾¾åˆ°å®šæ—¶æ‰§è¡Œç­‰æ•ˆæœ\n\nä¸è¿‡ï¼Œå¦‚æœé˜…è¯»è¿‡é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œå°±ä¼šå‘ç°ï¼Œä¸å»ºè®®ä½¿ç”¨ Executors æ¥åˆ›å»ºçº¿ç¨‹ã€‚ä¸»è¦åŸå› æ˜¯ï¼šç”¨è¿™æ ·çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä½¿ç”¨è€…å¯¹äºè¿™ä¸ªé»˜è®¤çº¿ç¨‹æ± çš„è§„åˆ™æ˜¯ä¸å¤Ÿäº†è§£çš„ï¼Œè¿™å°±æœ‰å¯èƒ½å¯¼è‡´ä½¿ç”¨ä¸å½“ã€‚\næ‰€ä»¥ï¼Œä¸€èˆ¬å»ºè®®ä½¿ç”¨ ThreadPoolExecutor æ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œå¹¶ç”±ä½¿ç”¨è€…æ¥è®¾ç½®çº¿ç¨‹æ± çš„ä¸€äº›æ ¸å¿ƒå‚æ•°ï¼Œä¿è¯ä½¿ç”¨è€…å¯¹äºè¿™ä¸ªè‡ªå®šä¹‰çº¿ç¨‹æ± çš„è§„åˆ™æ˜¯äº†è§£çš„ã€‚\n\n\nè§£è¯»ä¸€ä¸‹çº¿ç¨‹æ± çš„7å¤§æ ¸å¿ƒå‚æ•°ï¼Ÿ\ncorePoolSize : æ ¸å¿ƒçº¿ç¨‹æ•°\nmaximumPoolSize : æœ€å¤§çº¿ç¨‹æ•° (æ ¸å¿ƒçº¿ç¨‹æ•°+æ•‘æ€¥çº¿ç¨‹æ•°)\nkeepAliveTime : ç©ºé—²çš„æ•‘æ€¥çº¿ç¨‹çš„æœ€å¤§å­˜æ´»æ—¶é—´\nTimeUnit : keepAliveTime çš„æ—¶é—´å•ä½\nworkQueue : é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºå­˜æ”¾é‚£äº›å¾…æ‰§è¡Œçš„ä»»åŠ¡\nthreadFactory : åˆ›å»ºçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ (ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤å³å¯)\nrejectedHandler : æ‹’ç»ç­–ç•¥ã€‚å½“çº¿ç¨‹æ± ä¸­çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”çº¿ç¨‹æ•°å·²è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°æ—¶ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\nAbortPolicy : æ‹’ç»æ–°ä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸\nDiscardPolicy : æ‹’ç»æ–°ä»»åŠ¡ï¼Œä½†ä¸æŠ›å‡ºå¼‚å¸¸\nCallerRunsPolicy : ä½¿ç”¨å½“å‰è°ƒç”¨çš„çº¿ç¨‹æ¥æ‰§è¡Œæ­¤ä»»åŠ¡ (ç›¸å½“äºä¸ºäº†è®©ä»»åŠ¡ä¸å¤±è´¥ï¼Œäºæ˜¯è®©å®ƒæ’é˜Ÿ)\nDiscardOldestPolicy : æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—å¤´éƒ¨ (æœ€æ—§) çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡\n\n\n\n\n\nå¯¹äºé˜»å¡é˜Ÿåˆ—çš„ä½¿ç”¨ï¼Œéœ€è¦è¿›è¡Œä¸€ç‚¹è¯´æ˜ï¼š\n\nå¦‚æœä½¿ç”¨çš„æ˜¯ LinkedBlockingQueue ç­‰æ— ç•Œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆå¯ä»¥æ— é™åœ°å‘çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡ (å› ä¸ºé˜»å¡é˜Ÿåˆ—ä¸ä¼šæ»¡) è€Œä¸ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚å¹¶ä¸”ï¼Œä¹Ÿä¸ä¼šè§¦å‘æ•‘æ€¥çº¿ç¨‹ã€‚æ‰€ä»¥ï¼Œç›¸å½“äº maximumPoolSize, keepAliveTime, TimeUnit, rejectedHandler éƒ½æ˜¯æ— æ„ä¹‰çš„å‚æ•°ã€‚\nå¦‚æœä½¿ç”¨çš„æ˜¯ ArrayBlockingQueue ç­‰æœ‰ç•Œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆå¦‚æœé˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œå°±ä¼šè§¦å‘æ•‘æ€¥çº¿ç¨‹ã€‚å¦‚æœæ•‘æ€¥çº¿ç¨‹ä¹Ÿè¾¾åˆ°äº†ä¸Šé™ï¼Œé‚£ä¹ˆå†æœ‰æ–°ä»»åŠ¡æ—¶å°±ä¼šè§¦å‘æ‹’ç»ç­–ç•¥ã€‚\n\n\n\nçº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹ï¼Ÿ\nå½“çº¿ç¨‹æ•°å°äº corePoolSize æ—¶ï¼Œä½¿ç”¨æ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡\nå½“çº¿ç¨‹æ•°å¤§äº corePoolSize æ—¶ï¼Œå°†å¤šä½™çš„ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—\nå½“é˜»å¡é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œå¯åŠ¨æ•‘æ€¥çº¿ç¨‹æ¥æ‰§è¡Œ\nå½“é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”çº¿ç¨‹æ•°å·²è¾¾åˆ° maximumPoolSize æ—¶ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥\nå½“é˜»å¡é˜Ÿåˆ—ä¸å†æ»¡æ—¶ï¼Œå·²åˆ›å»ºçš„é‚£äº›æ•‘æ€¥çº¿ç¨‹å°±è¿›å…¥ç©ºé—²çŠ¶æ€ã€‚å¦‚æœå®ƒä»¬çš„ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTime ï¼Œå°±ä¼šå›æ”¶è¿™äº›æ•‘æ€¥çº¿ç¨‹\n\n\n\nsubmit() å’Œ execute() çš„åŒºåˆ«ï¼Ÿè¿™ä¸¤è€…éƒ½æ˜¯ç”¨äºå‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡çš„ã€‚\nåŒºåˆ«åœ¨äºï¼š\n\nexecute() æ²¡æœ‰è¿”å›å€¼\nsubmit() è¿”å›å€¼æ˜¯ä¸€ä¸ª Future å¯¹è±¡ï¼Œä»è€Œå¯ä»¥å¾—åˆ°å¼‚æ­¥æ‰§è¡Œçš„ç»“æœ\n\n\n\nsynchronized å…³é”®å­—synchronized ä¿®é¥°åœ¨ä¸åŒçš„ä½ç½®ï¼Œå„ä»£è¡¨ä»€ä¹ˆï¼Ÿ\nå¦‚æœ synchronized ä¿®é¥°çš„æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œåˆ™ä¸Šé”çš„æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡å®ä¾‹\nå¦‚æœ synchronized ä¿®é¥°çš„æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œåˆ™ä¸Šé”çš„æ˜¯æ‰€åœ¨ç±»çš„Classå®ä¾‹\nå¦‚æœ synchronized ä¿®é¥°çš„æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œåˆ™ä¸Šé”çš„æ˜¯ä¼ å…¥ synchronized æ‹¬å·å†…çš„å¯¹è±¡å®ä¾‹\n\nè¯·çŸ¥é“ä¸€æ¡åŸåˆ™ï¼šåŒæ­¥å—çš„ä½œç”¨èŒƒå›´è¶Šå°è¶Šå¥½ã€‚\n\n\nsynchronized çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå‰ç½®çŸ¥è¯†ç‚¹ï¼šMark Word ã€Monitor å¯¹è±¡\næ— è®º synchronized ä¿®é¥°çš„æ˜¯ä»€ä¹ˆï¼Œå¯¹åº”çš„é”éƒ½æ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚\nä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„ï¼šå¯¹è±¡å¤´ã€å¯¹è±¡å®é™…å†…å®¹ã€å¯¹é½å¡«å……å­—æ®µã€‚synchronized çš„åŸç†ï¼Œå°±åœ¨äºå¯¹è±¡å¤´ä¹‹ä¸­çš„ Mark Word éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†å°±è´Ÿè´£è®°å½•å¯¹è±¡å…³äºé”çš„ä¿¡æ¯ã€‚\n\nå¦å¤–ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ª Monitor å¯¹è±¡ï¼Œå­˜å‚¨ç€å½“å‰æŒæœ‰è¯¥ (å¯¹è±¡) é”çš„çº¿ç¨‹ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªé˜»å¡ç­‰å¾…è¯¥ (å¯¹è±¡) é”çš„ç­‰å¾…é˜Ÿåˆ—ã€‚\n\n\n\n\né”çš„ä¼˜åŒ–åœ¨JDK1.6ä¹‹å‰ï¼Œé”çš„æ“ä½œéƒ½æ˜¯é‡é‡çº§çš„ï¼šmonitorå¯¹è±¡ç›´æ¥å­˜å‚¨æŒæœ‰ç€é”çš„çº¿ç¨‹çš„idï¼Œå¹¶è®¾ç½® Mark Word ä¸­çš„ monitorå¯¹è±¡åœ°å€ï¼ŒæŠŠå…¶ä»–é˜»å¡ç­‰å¾…çš„çº¿ç¨‹éƒ½åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚è¿™ä¸ªåŠ é”çš„è¿‡ç¨‹æ˜¯ä¾èµ–åº•å±‚æ“ä½œç³»ç»Ÿçš„ mutex æŒ‡ä»¤çš„ï¼Œå­˜åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„åˆ‡æ¢ï¼Œæ‰€ä»¥æ€§èƒ½æŸè€—ååˆ†ä¸¥é‡ã€‚\nåœ¨JDK1.6ä¹‹åï¼Œå¼•å…¥äº†åå‘é”ã€è½»é‡çº§é”çš„æ¦‚å¿µï¼Œå®ƒä»¬æ˜¯åœ¨JVMå±‚é¢çš„è§„å®šï¼Œæ‰€ä»¥å°±ä¸ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿï¼Œæ€§èƒ½å¾—åˆ°å¤§å¹…æå‡ã€‚\næ— é”=&gt;operation: æ— é”åå‘é”=&gt;operation: åå‘é”è½»é‡çº§é”=&gt;operation: è½»é‡çº§é”é‡é‡çº§é”=&gt;operation: é‡é‡çº§é”æ— é”-&gt;åå‘é”-&gt;è½»é‡çº§é”-&gt;é‡é‡çº§é”\n\n\nåå‘é”\nJVMè®¤ä¸ºåœ¨åŒä¸€æ—¶é—´ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ï¼Œå³ï¼šè¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰ç«äº‰çš„ç¯å¢ƒã€‚\næ‰€ä»¥ç›´æ¥åœ¨ Mark Word ä¸­è®°å½•è¯¥çº¿ç¨‹ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³è¦è·å¾—é”ï¼Œå°±ç›´æ¥æ¯”å¯¹çº¿ç¨‹IDä¸ Mark Word ä¸­å­˜æ”¾çš„æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´å°±å¯ä»¥ç›´æ¥è·å¾—è¿™ä¸ªé”ï¼›å¦åˆ™ï¼Œç”¨CASæ¥å°è¯•ä¿®æ”¹ Mark Word ï¼Œå°†è®°å½•æ”¹ä¸ºå½“å‰çº¿ç¨‹IDã€‚\nå¦‚æœCASä¿®æ”¹æˆåŠŸï¼Œé‚£ä¹ˆçº¿ç¨‹ä»æ—§å¯ä»¥è·å¾—è¿™ä¸ªé”ï¼›å¦åˆ™ï¼Œè¯´æ˜å½“å‰ç¯å¢ƒæ˜¯å­˜åœ¨ç«äº‰çš„ï¼Œäºæ˜¯å‡çº§ä¸ºè½»é‡çº§é”ã€‚\n\nè½»é‡çº§é”\nå½“å‰çº¿ç¨‹ä¼šåœ¨æ ˆå¸§ä¸‹åˆ›å»º Lock Record ï¼ŒæŠŠ Mark Word çš„ä¿¡æ¯éƒ½æ‹·è´è¿›å»ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³è¦è·å¾—é”ï¼Œå…ˆç”¨CASæ¥å°è¯•å°† Mark Word ä¿¡æ¯ä¿®æ”¹ä¸ºè¯¥çº¿ç¨‹çš„ Lock Record ã€‚\nå¦‚æœCASä¿®æ”¹æˆåŠŸï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è·å–åˆ°äº†è¿™ä¸ªé” (è½»é‡çº§) ï¼›å¦åˆ™ï¼Œè¿›è¡Œè‡ªæ—‹é‡è¯•ã€‚å½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°åä»ä¸èƒ½è·å¾—é”ï¼Œå°±å‡çº§ä¸ºé‡é‡çº§é”ã€‚\n\n\nä»ä½¿ç”¨å±‚é¢çœ‹ï¼Œè‡³å§‹è‡³ç»ˆéƒ½æ˜¯ synchronized ï¼Œå³ï¼šè¿™ç§ä¼˜åŒ–æ˜¯å†…éƒ¨çš„ï¼Œå¯¹äºä½¿ç”¨è€…è€Œè¨€æ˜¯æ— æ„ŸçŸ¥çš„ã€‚å¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯ä¸ºäº†èƒ½å¤Ÿå°½å¯èƒ½åœ°æé«˜å¹¶å‘æ‰§è¡Œæ—¶çš„æ•ˆç‡é—®é¢˜ã€‚\næ­¤å¤–ï¼Œé”åªæœ‰å‡çº§ï¼Œä¸å­˜åœ¨é™çº§ã€‚\n\nåªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼šåå‘é”\nå¤šä¸ªçº¿ç¨‹äº¤æ›¿è¿›å…¥ä¸´ç•ŒåŒºï¼šè½»é‡çº§é”\nå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºï¼šé‡é‡çº§é”\n\n\n\nå…³äº java.util.concurrentä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯å¦‚ä½•ç†è§£çš„ï¼Ÿ\nä¹è§‚é”ï¼šéå¸¸ä¹è§‚ï¼Œè®¤ä¸ºæ¯æ¬¡æ‹¿åˆ°çš„æ•°æ®éƒ½æ²¡æœ‰è¢«äººä¿®æ”¹è¿‡ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ã€‚\nåœ¨è¿›è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯CASç®—æ³•ï¼šå…ˆåˆ¤æ–­å½“å‰å€¼æ˜¯å¦æ˜¯é¢„æœŸå€¼ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å¯ä»¥è¿›è¡Œå†™æ“ä½œå†™å…¥æ–°å€¼ï¼›å¦åˆ™ï¼Œè¢«å‘ŠçŸ¥è¿™æ¬¡ç«äº‰å¤±è´¥ï¼Œç„¶åè¿›è¡Œå†æ¬¡å°è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚\nä¹è§‚é”çš„ç¼ºç‚¹æ˜¯ï¼š\n\nABA é—®é¢˜\nçº¿ç¨‹1è¯»å–äº†æŸå˜é‡çš„å€¼æ˜¯A ã€‚æ­¤æ—¶çº¿ç¨‹2ä¹Ÿè¯»å–äº†è¯¥å˜é‡ï¼Œå¹¶ä¸”çº¿ç¨‹2å°†å®ƒæ”¹ä¸ºäº†B ï¼Œååˆæ”¹å›ä¸ºA ã€‚\nç„¶åçº¿ç¨‹1è¿›è¡ŒCASæ“ä½œï¼Œå‘ç°å½“å‰å€¼ä¸é¢„æœŸå€¼ä¸€è‡´ï¼Œå‡ä¸ºA ï¼Œäºæ˜¯æ”¾å¿ƒåœ°å†™å…¥äº†æ–°å€¼ã€‚\nä»¥ä¸Šè¿‡ç¨‹ï¼Œçº¿ç¨‹1çš„CASæ“ä½œæ˜¯æˆåŠŸçš„ï¼Œä½†è¿™æ˜¯æœ‰æ½œåœ¨éšæ‚£çš„ã€‚\nä» JDK1.5 å¼€å§‹ï¼Œæä¾›äº†ä¸€ä¸ªåä¸º AtomicStampedReference çš„ç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå³å¢åŠ äº†ä¸€ä¸ªæ¯”å¯¹å…ƒç´ ï¼šç‰ˆæœ¬å·ã€‚æ¯æ¬¡æ“ä½œåéƒ½ä¼šæ›´æ–°è¿™ä¸ªç‰ˆæœ¬å·ã€‚è¿™æ ·ï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªå€¼ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯CASå¤±è´¥ã€‚\n\nå¦‚æœèµ„æºç«äº‰ååˆ†æ¿€çƒˆï¼Œé‚£ä¹ˆCASè‡ªæ—‹çš„æ¦‚ç‡ä¼šå¾ˆé«˜ï¼Œä»è€Œå¯¼è‡´å¤§å¤šæ•°æ—¶é—´éƒ½æ˜¯åœ¨æµªè´¹CPUèµ„æºï¼Œæ•ˆç‡åè€Œä¸å¦‚ synchronized ã€‚\n\nåªèƒ½ä¿è¯å¯¹äºä¸€ä¸ªå˜é‡çš„åŸå­æ“ä½œã€‚å¦‚æœéœ€è¦ä¿è¯å¯¹äºå¤šä¸ªå˜é‡çš„åŸå­æ“ä½œï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨é”äº†ã€‚\n\n\n\næ‚²è§‚é”ï¼šéå¸¸æ‚²è§‚ï¼Œæ€»æ˜¯åšæœ€åçš„æ‰“ç®—ï¼Œè®¤ä¸ºæ¯æ¬¡æ‹¿åˆ°çš„æ•°æ®éƒ½æ˜¯è¢«äººä¿®æ”¹è¿‡äº†çš„ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿åˆ°æ•°æ®æ—¶éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±æ‹¿ä¸åˆ°äº†ã€‚\nJava çš„åŒæ­¥å…³é”®å­— synchronized å°±æ˜¯æ‚²è§‚é”çš„ã€‚æ­¤å¤–ï¼Œä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ (ä¾‹å¦‚MySQL) é‡Œé¢çš„è¡Œé”ã€è¡¨é”ã€è¯»é”ã€å†™é”ç­‰ï¼Œç”¨åˆ°çš„ä¹Ÿéƒ½æ˜¯æ‚²è§‚é”çš„æœºåˆ¶ã€‚\næ‚²è§‚é”æ˜¯è¶³å¤Ÿå®‰å…¨çš„ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šæ¯æ¬¡æ“ä½œéƒ½è¦ä¸Šé”ï¼Œç»“æŸåå†é‡Šæ”¾é”ï¼Œæ¯”è¾ƒè€—æ—¶ã€‚\n\n\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ (ç«äº‰ä¸æ˜¯ç‰¹åˆ«æ¿€çƒˆ) ï¼Œä¹è§‚é”çš„æ€§èƒ½æ˜¯å¥½äºæ‚²è§‚é”çš„ã€‚\n\n\nLock æ¥å£æ˜¯ä»€ä¹ˆï¼Ÿå¯¹æ¯”ä¼ ç»Ÿçš„åŒæ­¥ï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼ŸLock æ¥å£æ˜¯åŒæ­¥çš„æ‰©å±•ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ **çµæ´» **ã€‚å…¸å‹çš„å®ç°ç±»æ˜¯ ReentrantLock ã€‚\n\næ”¯æŒå…¬å¹³&#x2F;éå…¬å¹³çš„æ¨¡å¼é€‰æ‹© (å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä¸€èˆ¬éƒ½æ˜¯é»˜è®¤éå…¬å¹³æ¨¡å¼)\nå…è®¸çº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶è¢«ä¸­æ–­\nå…è®¸è®©çº¿ç¨‹å»å°è¯•è·å¾—é”ï¼Œå¦‚æœæ— æ³•è·å¾—ï¼Œå¯ä»¥é€‰æ‹©ç«‹å³è¿”å›ä¸å†ç­‰å¾…æˆ–æ˜¯ç­‰å¾…ä¸€æ®µæ—¶é—´ (å¸¦æœ‰è¶…æ—¶æ—¶é—´)\né…åˆæ¡ä»¶å˜é‡ Condition æ¥ä½¿ç”¨ï¼Œè¾¾åˆ° wait&#x2F;notify çš„æ•ˆæœï¼Œå¹¶ä¸”æ˜¯æ”¯æŒä¸­æ–­ã€è¶…æ—¶çš„\n\n\n\nå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿç®€å•æ¥è¯´ï¼Œå…¬å¹³é”æ¨¡å¼æ˜¯è®²ç©¶å…ˆæ¥ååˆ°çš„é¡ºåºçš„ï¼›éå…¬å¹³é”æ¨¡å¼æ˜¯è°å‡†å¤‡å¥½äº†å°±è°æ¥ã€‚\nå…¬å¹³é”ï¼šåœ¨ç«äº‰ç¯å¢ƒä¸‹ï¼Œå…ˆåˆ°è¾¾ä¸´ç•ŒåŒºçš„çº¿ç¨‹ä¸€å®šæ¯”ååˆ°è¾¾ä¸´ç•ŒåŒºçš„çº¿ç¨‹æ›´æ—©åœ°è·å¾—é”ã€‚\néå…¬å¹³é”ï¼šåœ¨ç«äº‰ç¯å¢ƒä¸‹ï¼Œå…ˆåˆ°è¾¾ä¸´ç•ŒåŒºçš„çº¿ç¨‹æœªå¿…æ¯”ååˆ°è¾¾ä¸´ç•ŒåŒºçš„çº¿ç¨‹æ›´æ—©åœ°è·å¾—é”ã€‚\næ‰€ä»¥ï¼Œå†³å®šå®ƒä»¬çš„å› ç´ å°±æ˜¯ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾äº†ä¸´ç•ŒåŒºï¼Œå®ƒæ˜¯å¦ä¼šç›´æ¥å°è¯•è·å¾—é” (éå…¬å¹³) ï¼Œè¿˜æ˜¯ä¼šç›´æ¥è¿›å…¥ç­‰å¾…é˜Ÿåˆ— (å…¬å¹³) ã€‚\n\n\nå¹¶å‘å®¹å™¨ç±»\nCopyOnWriteArrayList (æ€§èƒ½è¾ƒå·®çš„åŒæ­¥å®¹å™¨æ˜¯ Vector)\nä¸»è¦ç‰¹ç‚¹æ˜¯ï¼šè¯»å†™åˆ†ç¦»ã€‚\n\nå®é™…çš„å†™æ“ä½œå‘ç”Ÿåœ¨å¤åˆ¶çš„æ•°ç»„ä¸Šï¼Œè€Œè¯»æ“ä½œè¿˜æ˜¯åœ¨åŸå§‹æ•°ç»„ä¸­è¿›è¡Œï¼Œä»è€Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œäº’ä¸å½±å“ã€‚\nåœ¨å†™æ“ä½œæ—¶éœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥æ—¶å¯¼è‡´å†™å…¥æ•°æ®ä¸¢å¤±ã€‚\nåœ¨å†™æ“ä½œç»“æŸåï¼ŒæŠŠåŸå§‹æ•°ç»„çš„å¼•ç”¨æŒ‡å‘æ–°çš„å¤åˆ¶æ•°ç»„ã€‚\n\nç¼ºç‚¹æ˜¯ï¼š\n\nç”±äºæ¯æ¬¡å†™æ“ä½œéƒ½ä¼šå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œæ‰€ä»¥æ˜¯æ¯”è¾ƒè€—è´¹å†…å­˜çš„ã€‚\nåªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ— æ³•ä¿è¯å®æ—¶ä¸€è‡´æ€§ã€‚\n\næˆ‘ä»¬å¯ä»¥ä»ä¸­å­¦åˆ°çš„çº¿ç¨‹å®‰å…¨è§£å†³æ€è·¯æ˜¯ï¼šé€šè¿‡å¦è¾Ÿç©ºé—´ï¼Œæ¥è§£å†³å¹¶å‘é—®é¢˜ã€‚\n\nConcurrentHashMap (æ€§èƒ½è¾ƒå·®çš„åŒæ­¥å®¹å™¨æ˜¯ HashTable)\nåº•å±‚æ•°æ®ç»“æ„ä¸æ™®é€šçš„ HashMap ä¸€æ ·ï¼ŒåŒä¸ºæ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘æ ‘ã€‚\n\nåœ¨ put() å†™æ“ä½œæ—¶éœ€è¦åŠ é”ï¼Œä¸è¿‡ä½¿ç”¨çš„æ˜¯ CASç®—æ³• (åœ¨JDK8ä¹‹å‰ï¼Œä½¿ç”¨çš„æ˜¯åˆ†æ®µé”çš„æ–¹å¼)\nåœ¨ get() è¯»æ“ä½œæ—¶ä¸åŠ é”ï¼Œvalueå±æ€§é€šè¿‡ volatile å…³é”®å­—è¿›è¡Œä¿®é¥°ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œå³æ¯æ¬¡ get() å¾—åˆ°çš„éƒ½æ˜¯æœ€æ–°å€¼\n\n\n\n\n\nåŒæ­¥å·¥å…·ç±»\nCountDownLatch\nåœ¨åˆ›å»ºæ—¶ä¼ å…¥ä¸€ä¸ªå‚æ•° new CountDownLatch(int initial) ä½œä¸ºè®¡æ•°æ¬¡æ•°ã€‚\nå…¶ä»–çº¿ç¨‹æ¯è°ƒç”¨ä¸€æ¬¡ countDown() æ–¹æ³•ï¼Œè®¡æ•°å™¨å‡1ã€‚\nå½“è®¡æ•°å™¨è¢«å‡ä¸º0æ—¶ï¼Œä¸»çº¿ç¨‹ä» latch.await() å¤„é‡æ–°è¢«å”¤é†’ï¼Œç„¶åç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚\n\nCyclicBarrier\nå’Œ CountDownLatch çš„ä½œç”¨ä¸€æ ·ï¼Œåªä¸è¿‡ CountDownLatch åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä½¿ç”¨ä¹‹åå°±ä¼šå¤±æ•ˆï¼Œè€Œ CyclicBarrier å¯ä»¥åå¤ä½¿ç”¨ã€‚\n\nSemaphore\nåœ¨ä¸è¶…è¿‡è®¾å®šä¸Šé™çš„çº¿ç¨‹æ•°çš„æƒ…å†µä¸‹ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚ä¸»è¦ç”¨äºé™æµä¹‹ç±»çš„æ“ä½œï¼Œé™åˆ¶æŸæ®µä»£ç å—çš„å¹¶å‘æ•°ã€‚æ‰“ä¸ªæ¯”å–»ï¼šSemaphore å°±å¥½æ¯”æ˜¯ä¸€ä¸ªåœè½¦åœºï¼Œå…è®¸åŒæ—¶åœæ”¾å¤šè¾†è½¦è¾†ï¼Œä½†ä¹Ÿæ€»æœ‰ä¸€ä¸ªä¸Šé™ã€‚\nå¦‚æœ Semaphore çš„æ„é€ å‡½æ•°ä¸­ä¼ å…¥çš„å‚æ•°æ˜¯ 1 ï¼Œå°±ç›¸å½“äºä¸€ä¸ª synchronized äº†ã€‚\n\n\n\n\nAQSæ˜¯ä»€ä¹ˆï¼Ÿå…¨ç§°æ˜¯ AbstractQueuedSynchronizer ã€‚ä½œä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç›¸å½“äºæ˜¯å¾ˆå¤šåŒæ­¥å®¹å™¨çš„æ¡†æ¶æ¨¡æ¿ï¼Œå…¶ä¸­åˆ¶å®šäº†å¾ˆå¤šç”¨äºä¿è¯çº¿ç¨‹å®‰å…¨çš„åŸºæœ¬è§„åˆ™ã€‚\nå¸¸ç”¨çš„å®ç°ç±»æœ‰ ReentrantLock, Semaphore, FutureTask ç­‰ã€‚\n\n\nAQSçš„åŸç†åº•å±‚æ˜¯ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥ç»´æŠ¤ä¸€ä¸ªFIFOçš„ç­‰å¾…é˜Ÿåˆ—ï¼Œè¿˜æœ‰ä¸€ä¸ª state çš„çŠ¶æ€å˜é‡ã€‚\né˜Ÿåˆ—ä¸­å­˜å‚¨çš„å®ä½“æ˜¯ Node èŠ‚ç‚¹ï¼Œè®°å½•äº†å½“å‰çš„çŠ¶æ€å€¼ã€åŒæ­¥æ¨¡å¼ (ç‹¬å  &#x2F; å…±äº«) ã€å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹ã€‚\næ€»ä½“æµç¨‹æ˜¯ï¼šæŠŠéœ€è¦ç­‰å¾…çš„çº¿ç¨‹ä»¥ Node èŠ‚ç‚¹çš„å½¢å¼åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç”¨ state å˜é‡æ¥ç»´æŠ¤å½“å‰é”çš„çŠ¶æ€ã€‚\nå½“è°ƒç”¨äº† lock() æ–¹æ³•æ—¶ï¼š\n\nä½¿ç”¨CASæ¥å°è¯•è·å¾—é”ã€‚å¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ï¼›\n\nå¦åˆ™ï¼Œè°ƒç”¨ acquire() æ–¹æ³•ï¼Œåˆ¤æ–­ state æ˜¯å¦ä¸º0ã€‚å¦‚æœç­‰äº0ï¼Œè¯´æ˜æ²¡æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆå°±å†è¿›è¡Œä¸€æ¬¡CASå°è¯•ã€‚å¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ï¼›\n\nå¦åˆ™ï¼Œè¯´æ˜æœ‰çº¿ç¨‹æ­£åœ¨æŒæœ‰ç€è¿™æŠŠé”ã€‚äºæ˜¯å†åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰ç€é”ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ›´æ–° state çš„å€¼åŠ 1 (è¿™é‡Œæ­£æ˜¯å¯é‡å…¥çš„ä½“ç°) ï¼Œç„¶åå°±å¯ä»¥æ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ï¼›\n\nå¦åˆ™ï¼Œåªèƒ½å°†å½“å‰çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åå°†è‡ªå·± park() æŒ‚èµ·ï¼Œç­‰å¾…åç»­è¢«å”¤é†’åå†ç»§ç»­è¿›è¡ŒCASå°è¯•â€¦â€¦ç›´è‡³æˆåŠŸï¼Œç„¶åæ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ã€‚\nåœ¨åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®è¿˜æœ‰ä¸€äº›ç»†èŠ‚ï¼š\n\nèŠ‚ç‚¹å…¥é˜Ÿåï¼Œä¼šåˆ¤æ–­å‰é©±èŠ‚ç‚¹æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ã€‚å¦‚æœæ˜¯å¤´èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥å†è¿›è¡Œä¸€æ¬¡CASå°è¯•ã€‚å¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ï¼›\nå¦åˆ™ï¼Œä¼šæŠŠå‰é©±èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®ä¸º SIGNAL (-1) ï¼Œç”¨ä»¥è¡¨ç¤ºåç»­èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’ï¼Œè€Œè¿™ä¸ªä»»åŠ¡å°±äº¤ç»™äº†å‰é©±èŠ‚ç‚¹ã€‚\n\n\n\nå½“è°ƒç”¨äº† unlock() æ–¹æ³•æ—¶ï¼Œå°±éå¸¸ç®€å•äº†ï¼šæŠŠ state ç½®0ï¼Œç„¶åå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªéœ€è¦è¢«å”¤é†’çš„èŠ‚ç‚¹ (èŠ‚ç‚¹çš„ state å°äº0) ï¼Œç„¶åè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›è¡ŒCASå°è¯•æ¥è·å¾—é”ã€‚\n\n\nAQSçš„åŒæ­¥æ–¹å¼æ˜¯ä»€ä¹ˆï¼ŸAQSæ”¯æŒä¸¤ç§åŒæ­¥æ–¹å¼ï¼šç‹¬å å¼å’Œå…±äº«å¼ã€‚\nç‹¬å å¼ï¼Œé”åªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚å¦‚ ReentrantLock\nå…±äº«å¼ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚å¦‚ Semaphore, CountDownLatch\n\n\nvolatile å…³é”®å­—volatile çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\nvolatile å¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ã€‚è¢« volatile ä¿®é¥°çš„å˜é‡åœ¨è¿›è¡Œå†™æ“ä½œåï¼Œå…¶ä»–çº¿ç¨‹èƒ½é©¬ä¸Šè¯»åˆ°æœ€æ–°å€¼ã€‚\n\nvolatile è¿˜å¯ä»¥ä¿è¯ä¸ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åºçš„é—®é¢˜ã€‚æœ€å…¸å‹çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯ æ‡’æ±‰å¼çš„DCLå•ä¾‹æ¨¡å¼äº†å§ï¼\n\n\nclass Singleton &#123;  /** è¿™é‡Œä¸€å®šè¦ä½¿ç”¨ volatile å…³é”®å­—æ¥ä¿®é¥°å•ä¾‹å®ä¾‹ï¼Œä»¥é˜²æ­¢æŒ‡ä»¤é‡æ’åºå¯¼è‡´çš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ */  private static volatile Singleton singleton;    /** æ„é€ å™¨ä½¿ç”¨ private ä¿®é¥°ï¼Œå¯¹å¤–éƒ¨è¿›è¡Œå±è”½ */  private Singleton() &#123;&#125;    /** å¯¹å¤–æš´éœ²çš„å”¯ä¸€æ¥å£ã€‚ä½¿ç”¨DCLæœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ */  public static Singleton getInstance() &#123;    if (singleton == null) &#123;      synchronized (Singleton.class) &#123;        if (singleton == null) &#123;          singleton = new Singleton();        &#125;      &#125;    &#125;    return singleton;  &#125;&#125;\n\nâ€‹\tçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼è¿˜å¯ä»¥æ˜¯é™æ€å†…éƒ¨ç±»ï¼›äº¦æˆ–æ˜¯ç›´æ¥ä½¿ç”¨é¥¿æ±‰å¼ï¼Œåœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºï¼Œç”±jvmä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ã€‚\nâ€‹\tä¸è¿‡å°±ä¸å±•å¼€äº†ï¼Œæ¯•ç«Ÿæœ¬æ–‡çš„ä¸»è¦å†…å®¹ä¸æ˜¯è®¾è®¡æ¨¡å¼ :-)\n\nä¸CASæ“ä½œç»“åˆï¼Œä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚\n\n\n\nä¸ºä»€ä¹ˆä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åºï¼Ÿè¿™æ˜¯å‡ºäºæ€§èƒ½æœ€å¤§åŒ–è€ƒè™‘ï¼ŒCPUå¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚å½“ç„¶ï¼Œå‰ææ˜¯ä¸èƒ½æ”¹å˜ç¨‹åºçš„è¿è¡Œç»“æœ ğŸ¤£ å¦åˆ™å²‚ä¸æ˜¯ä¹±äº†å¥—äº†ï¼Œç¼–ç¨‹æˆäº†ä¸€ä¸ªç„å­¦é—®é¢˜äº†ã€‚\n","tags":["Java","å¤šçº¿ç¨‹"]}]